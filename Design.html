<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>مصمم بيت ذكي ثلاثي الأبعاد</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
<style>
  body { font-family: Arial, sans-serif; background-color: #f4f4f4; padding: 20px; }
  form { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1);}
  label { display: block; margin-bottom: 10px; }
  input { width: 100%; padding: 8px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 4px; }
  button { background-color: #4caf50; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; }
  button:hover { background-color: #45a049; }
  #scene-container { width: 100%; height: 600px; margin-top: 20px; border: 1px solid #ccc; border-radius: 4px;}
  #measurements { margin-top: 20px; padding: 10px; background: #fff; border: 1px solid #ddd; border-radius: 4px; }
</style>
</head>
<body>
<h1>مصمم بيت ذكي ثلاثي الأبعاد</h1>
<form id="input-form">
  <label for="land-length">طول الأرض (متر):</label>
  <input type="number" id="land-length" required min="10" step="0.1" />
  <label for="land-width">عرض الأرض (متر):</label>
  <input type="number" id="land-width" required min="10" step="0.1" />
  <label for="num-rooms">عدد الغرف:</label>
  <input type="number" id="num-rooms" min="0" step="1" />
  <label for="num-bathrooms">عدد الحمامات:</label>
  <input type="number" id="num-bathrooms" min="0" step="1" />
  <button type="submit">إنشاء المخطط</button>
</form>

<div id="scene-container"></div>
<div id="measurements"></div>

<script>
let scene, camera, renderer, controls;

const form = document.getElementById("input-form");
const sceneContainer = document.getElementById("scene-container");
const measurementsDiv = document.getElementById("measurements");

form.addEventListener("submit", (event) => {
  event.preventDefault();

  const landLength = parseFloat(document.getElementById("land-length").value);
  const landWidth = parseFloat(document.getElementById("land-width").value);
  const numRooms = parseInt(document.getElementById("num-rooms").value) || 0;
  const numBathrooms = parseInt(document.getElementById("num-bathrooms").value) || 0;

  initScene(landLength, landWidth);
  createHouse(landLength, landWidth, numRooms, numBathrooms);
  animate();
});

function initScene(landLength, landWidth) {
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0xe0f7fa);

  camera = new THREE.PerspectiveCamera(75, sceneContainer.clientWidth / 600, 0.1, 1000);
  camera.position.set(landLength/2, 20, landWidth*1.5);

  renderer = new THREE.WebGLRenderer({ antialias:true });
  renderer.setSize(sceneContainer.clientWidth, 600);
  sceneContainer.innerHTML = "";
  sceneContainer.appendChild(renderer.domElement);

  controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;

  const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
  scene.add(ambientLight);

  const directionalLight = new THREE.DirectionalLight(0xffffff, 0.6);
  directionalLight.position.set(50,50,50);
  scene.add(directionalLight);

  // الأرضية
  const floorMaterial = new THREE.MeshPhongMaterial({ color: 0xcccccc });
  const floorGeometry = new THREE.PlaneGeometry(landLength, landWidth);
  const floor = new THREE.Mesh(floorGeometry, floorMaterial);
  floor.rotation.x = -Math.PI/2;
  scene.add(floor);
}

function createHouse(landLength, landWidth, numRooms, numBathrooms) {
  const wallThickness = 0.2;
  const hallHeight = 5;

  // الصالة: مكان ديناميكي
  const hallLength = Math.min(landLength*0.5, 8 + numRooms*0.5);
  const hallWidth = Math.min(landWidth*0.5, 6 + numRooms*0.3);
  const hallGeom = new THREE.BoxGeometry(hallLength, hallHeight, hallWidth);
  const hallMat = new THREE.MeshPhongMaterial({ color: 0x00ff00, transparent:true, opacity:0.5 });
  const hall = new THREE.Mesh(hallGeom, hallMat);
  hall.position.set(hallLength/2 + Math.random()*(landLength-hallLength), hallHeight/2, hallWidth/2 + Math.random()*(landWidth-hallWidth));
  scene.add(hall);
  addLabel(hall, `الصالة\n${hallLength.toFixed(1)}×${hallWidth.toFixed(1)}`);

  // توليد الممرات والغرف بشكل منطقي
  let occupied = [];
  function isOverlap(x,z,w,h) {
    return occupied.some(r => !(x+w < r.x || x > r.x+r.w || z+h < r.z || z > r.z+r.h));
  }

  // الغرف
  const roomSize = 4;
  for(let i=0; i<numRooms; i++){
    let tries=0;
    while(tries<50){
      let x = Math.random()*(landLength-roomSize);
      let z = Math.random()*(landWidth-roomSize);
      if(!isOverlap(x,z,roomSize,roomSize)){
        const roomGeom = new THREE.BoxGeometry(roomSize, hallHeight, roomSize);
        const roomMat = new THREE.MeshPhongMaterial({ color: 0x0000ff, transparent:true, opacity:0.5 });
        const room = new THREE.Mesh(roomGeom, roomMat);
        room.position.set(x+roomSize/2, hallHeight/2, z+roomSize/2);
        scene.add(room);
        addLabel(room, `غرفة\n${roomSize}×${roomSize}`);
        occupied.push({x,z,w:roomSize,h:roomSize});
        break;
      }
      tries++;
    }
  }

  // الحمامات
  const bathSize = 2;
  for(let i=0; i<numBathrooms; i++){
    let tries=0;
    while(tries<50){
      let x = Math.random()*(landLength-bathSize);
      let z = Math.random()*(landWidth-bathSize);
      if(!isOverlap(x,z,bathSize,bathSize)){
        const bathGeom = new THREE.BoxGeometry(bathSize, hallHeight, bathSize);
        const bathMat = new THREE.MeshPhongMaterial({ color: 0xff0000, transparent:true, opacity:0.5 });
        const bath = new THREE.Mesh(bathGeom, bathMat);
        bath.position.set(x+bathSize/2, hallHeight/2, z+bathSize/2);
        scene.add(bath);
        addLabel(bath, `حمام\n${bathSize}×${bathSize}`);
        occupied.push({x,z,w:bathSize,h:bathSize});
        break;
      }
      tries++;
    }
  }

  measurementsDiv.innerHTML = `
    <h2>القياسات:</h2>
    <p>الأرض: ${landLength}×${landWidth} م</p>
    <p>عدد الغرف: ${numRooms}</p>
    <p>عدد الحمامات: ${numBathrooms}</p>
    <p>سمك الجدران: ${wallThickness} م</p>
  `;
}

function addLabel(obj, text){
  const canvas = document.createElement('canvas');
  const size = 256;
  canvas.width = size;
  canvas.height = size;
  const ctx = canvas.getContext('2d');
  ctx.fillStyle='rgba(255,255,255,0.8)';
  ctx.fillRect(0,0,size,size);
  ctx.fillStyle='black';
  ctx.font='28px Arial';
  ctx.textAlign='center';
  ctx.textBaseline='middle';
  text.split('\n').forEach((line,i)=>{
    ctx.fillText(line,size/2,size/2 + i*30 -15);
  });
  const texture = new THREE.CanvasTexture(canvas);
  const spriteMaterial = new THREE.SpriteMaterial({ map:texture });
  const sprite = new THREE.Sprite(spriteMaterial);
  sprite.scale.set(obj.geometry.parameters.width,3,1);
  sprite.position.set(obj.position.x,obj.position.y+3,obj.position.z);
  scene.add(sprite);
}

function animate(){
  requestAnimationFrame(animate);
  controls.update();
  renderer.render(scene,camera);
}
</script>
</body>
</html>
