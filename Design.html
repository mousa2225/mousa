<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مصمم تخطيط عمراني لصالة مبنى ضخم</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/controls/OrbitControls.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f4f4; padding: 20px; }
        form { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        label { display: block; margin-bottom: 10px; }
        input { width: 100%; padding: 8px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 4px; }
        button { background-color: #4CAF50; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background-color: #45a049; }
        #scene-container { width: 100%; height: 600px; margin-top: 20px; }
        #measurements { margin-top: 20px; padding: 10px; background: #fff; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>حاسبة ومصمم تخطيط عمراني لصالة مبنى ضخم</h1>
    <form id="input-form">
        <label for="land-length">طول الأرض (بالمتر):</label>
        <input type="number" id="land-length" required min="10" step="0.1">

        <label for="land-width">عرض الأرض (بالمتر):</label>
        <input type="number" id="land-width" required min="10" step="0.1">

        <label for="num-rooms">عدد الغرف (اختياري):</label>
        <input type="number" id="num-rooms" min="0" step="1">

        <label for="num-bathrooms">عدد الحمامات (اختياري):</label>
        <input type="number" id="num-bathrooms" min="0" step="1">

        <button type="submit">إنشاء المخطط</button>
    </form>

    <div id="scene-container"></div>
    <div id="measurements"></div>

    <script>
        const form = document.getElementById('input-form');
        const sceneContainer = document.getElementById('scene-container');
        const measurementsDiv = document.getElementById('measurements');

        let scene, camera, renderer, controls;
        let font;

        const loader = new THREE.FontLoader();
        loader.load('https://threejs.org/examples/fonts/helvetiker_regular.typeface.json', function(f) {
            font = f;
        });

        form.addEventListener('submit', function(event) {
            event.preventDefault();

            const landLength = parseFloat(document.getElementById('land-length').value);
            const landWidth = parseFloat(document.getElementById('land-width').value);
            let numRooms = parseInt(document.getElementById('num-rooms').value) || 0;
            let numBathrooms = parseInt(document.getElementById('num-bathrooms').value) || 0;

            const totalArea = landLength * landWidth;
            const hallArea = totalArea * 0.6;
            const hallLength = landLength * 0.8;
            const hallWidth = hallArea / hallLength;

            const roomSize = 4;
            const bathroomSize = 2;
            const roomsPerSide = Math.ceil(numRooms / 2);
            const bathroomsPerSide = Math.ceil(numBathrooms / 2);
            const wallThickness = 0.2;
            const doorWidth = 1;

            init3D(landLength, landWidth);
            drawBuilding(landLength, landWidth, hallLength, hallWidth, numRooms, numBathrooms, roomSize, bathroomSize, wallThickness, doorWidth, roomsPerSide, bathroomsPerSide);

            displayMeasurements(landLength, landWidth, hallLength, hallWidth, numRooms, numBathrooms, roomSize, bathroomSize, wallThickness, doorWidth);

            animate();
        });

        function init3D(landLength, landWidth) {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xcccccc);

            camera = new THREE.PerspectiveCamera(75, sceneContainer.clientWidth / 600, 0.1, 1000);
            camera.position.set(landLength / 2, landWidth / 2 + 20, landLength + 20);
            camera.lookAt(new THREE.Vector3(landLength / 2, 0, landWidth / 2));

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(sceneContainer.clientWidth, 600);
            sceneContainer.innerHTML = '';
            sceneContainer.appendChild(renderer.domElement);

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.target.set(landLength / 2, 0, landWidth / 2);

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.6);
            directionalLight.position.set(landLength, landWidth, landLength);
            scene.add(directionalLight);

            const floorGeometry = new THREE.PlaneGeometry(landLength, landWidth);
            const floorMaterial = new THREE.MeshBasicMaterial({ color: 0xaaaaaa, side: THREE.DoubleSide });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            scene.add(floor);
        }

        function drawBuilding(landLength, landWidth, hallLength, hallWidth, numRooms, numBathrooms, roomSize, bathroomSize, wallThickness, doorWidth, roomsPerSide, bathroomsPerSide) {
            const hallGeometry = new THREE.BoxGeometry(hallLength, 5, hallWidth);
            const hallMaterial = new THREE.MeshBasicMaterial({ color: 0x00ff00, wireframe: true });
            const hall = new THREE.Mesh(hallGeometry, hallMaterial);
            hall.position.set(hallLength / 2, 2.5, landWidth / 2);
            scene.add(hall);

            addText(الصالة: ${hallLength}m x ${hallWidth}m, hall.position.x, 5.5, hall.position.z);

            // تصحيح roomOffset
            let roomOffset = landWidth / 2 + hallWidth / 2 + wallThickness + roomSize / 2;
            let lowerRoomOffset = landWidth - roomOffset;

            for (let i = 0; i < numRooms; i++) {
                const roomGeometry = new THREE.BoxGeometry(roomSize, 5, roomSize);
                const roomMaterial = new THREE.MeshBasicMaterial({ color: 0x0000ff, wireframe: true });
                const room = new THREE.Mesh(roomGeometry, roomMaterial);
                const isUpper = i < roomsPerSide;
                const sideIndex = i % roomsPerSide;
                room.position.set(sideIndex * (roomSize + wallThickness) + roomSize / 2, 2.5, isUpper ? roomOffset : lowerRoomOffset);
                scene.add(room);

                addDoor(room.position.x, room.position.z, doorWidth);

                addText(غرفة ${i+1}: ${roomSize}m x ${roomSize}m, room.position.x, 5.5, room.position.z);
            }

            // تصحيح bathOffset
            let bathOffsetAdd = numRooms > 0 ? (roomSize / 2 + wallThickness + bathroomSize / 2) : 0;
            let bathOffset = roomOffset + bathOffsetAdd;
            let lowerBathOffset = landWidth - bathOffset;

            for (let i = 0; i < numBathrooms; i++) {
                const bathGeometry = new THREE.BoxGeometry(bathroomSize, 5, bathroomSize);
                const bathMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000, wireframe: true });
                const bath = new THREE.Mesh(bathGeometry, bathMaterial);
                const isUpper = i < bathroomsPerSide;
                const sideIndex = i % bathroomsPerSide;
                bath.position.set(sideIndex * (bathroomSize + wallThickness) + bathroomSize / 2, 2.5, isUpper ? bathOffset : lowerBathOffset);
                scene.add(bath);

                addText(حمام ${i+1}: ${bathroomSize}m x ${bathroomSize}m, bath.position.x, 5.5, bath.position.z);
            }

            const outerWallGeometry = new THREE.BoxGeometry(landLength, 5, landWidth);
            const outerWallMaterial = new THREE.MeshBasicMaterial({ color: 0x000000, wireframe: true });
            const outerWall = new THREE.Mesh(outerWallGeometry, outerWallMaterial);
            outerWall.position.set(landLength / 2, 2.5, landWidth / 2);
            scene.add(outerWall);
        }

        function addDoor(x, z, doorWidth) {
            const doorMaterial = new THREE.LineBasicMaterial({ color: 0xffff00 });
            const doorPoints = [];
            doorPoints.push(new THREE.Vector3(x - doorWidth/2, 0, z));
            doorPoints.push(new THREE.Vector3(x + doorWidth/2, 0, z));
            const doorGeometry = new THREE.BufferGeometry().setFromPoints(doorPoints);
            const door = new THREE.Line(doorGeometry, doorMaterial);
            scene.add(door);
        }

        function addText(text, x, y, z) {
            if (!font) return; // إذا لم يتم تحميل الخط بعد
            const textGeometry = new THREE.TextGeometry(text, {
                font: font,
                size: 0.5,
                height: 0.1
            });
            const textMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });
            const textMesh = new THREE.Mesh(textGeometry, textMaterial);
            textMesh.position.set(x - text.length / 4, y, z);
            scene.add(textMesh);
        }

        function displayMeasurements(landLength, landWidth, hallLength, hallWidth, numRooms, numBathrooms, roomSize, bathroomSize, wallThickness, doorWidth) {
            let measurements = `
                <h2>القياسات الدقيقة:</h2>
                <p>مساحة الأرض الكلية: ${landLength} م × ${landWidth} م = ${landLength * landWidth} م²</p>
                <p>أبعاد الصالة الرئيسية: ${hallLength.toFixed(2)} م × ${hallWidth.toFixed(2)} م</p>
                <p>سمك الجدران: ${wallThickness} م</p>
                <p>عرض الأبواب: ${doorWidth} م</p>
            `;
            if (numRooms > 0) {
                measurements += <p>أبعاد كل غرفة: ${roomSize} م × ${roomSize} م</p>;
            }
            if (numBathrooms > 0) {
                measurements += <p>أبعاد كل حمام: ${bathroomSize} م × ${bathroomSize} م</p>;
            }
            // تحقق من المساحة الكافية
            const sideSpace = (landWidth - hallWidth) / 2;
            const requiredSide = wallThickness + roomSize + (numBathrooms > 0 ? wallThickness + bathroomSize : 0);
            if (sideSpace < requiredSide) {
                measurements += <p style="color: red;">تحذير: المساحة الجانبية غير كافية للغرف والحمامات. يرجى زيادة عرض الأرض أو تقليل العدد.</p>;
            }
            measurementsDiv.innerHTML = measurements;
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
