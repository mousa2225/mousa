<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>مصمم تخطيط عمراني ديناميكي</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f4f4f4; padding: 20px; }
    form { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1);}
    label { display: block; margin-bottom: 10px; }
    input { width: 100%; padding: 8px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 4px; }
    button { background-color: #4caf50; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background-color: #45a049; }
    #scene-container { width: 100%; height: 600px; margin-top: 20px; border: 1px solid #ccc; border-radius: 4px;}
    #measurements { margin-top: 20px; padding: 10px; background: #fff; border: 1px solid #ddd; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>مصمم تخطيط عمراني ديناميكي</h1>
  <form id="input-form">
    <label for="land-length">طول الأرض (متر):</label>
    <input type="number" id="land-length" required min="10" step="0.1" />
    <label for="land-width">عرض الأرض (متر):</label>
    <input type="number" id="land-width" required min="10" step="0.1" />
    <label for="num-rooms">عدد الغرف:</label>
    <input type="number" id="num-rooms" min="0" step="1" />
    <label for="num-bathrooms">عدد الحمامات:</label>
    <input type="number" id="num-bathrooms" min="0" step="1" />
    <button type="submit">إنشاء المخطط</button>
  </form>

  <div id="scene-container"></div>
  <div id="measurements"></div>

  <script>
    const form = document.getElementById("input-form");
    const sceneContainer = document.getElementById("scene-container");
    const measurementsDiv = document.getElementById("measurements");

    let scene, camera, renderer, controls;

    form.addEventListener("submit", function(event) {
      event.preventDefault();
      const landLength = parseFloat(document.getElementById("land-length").value);
      const landWidth = parseFloat(document.getElementById("land-width").value);
      const numRooms = parseInt(document.getElementById("num-rooms").value) || 0;
      const numBathrooms = parseInt(document.getElementById("num-bathrooms").value) || 0;

      const wallThickness = 0.2;
      const doorWidth = 1;

      init3D(landLength, landWidth);
      drawBuilding(landLength, landWidth, numRooms, numBathrooms, wallThickness, doorWidth);
      animate();
    });

    function init3D(landLength, landWidth) {
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0xe0f7fa);

      camera = new THREE.PerspectiveCamera(75, sceneContainer.clientWidth / 600, 0.1, 1000);
      camera.position.set(landLength/2, 20, landWidth*1.5);

      renderer = new THREE.WebGLRenderer({ antialias:true });
      renderer.setSize(sceneContainer.clientWidth, 600);
      sceneContainer.innerHTML = "";
      sceneContainer.appendChild(renderer.domElement);

      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;

      const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
      scene.add(ambientLight);
      const directionalLight = new THREE.DirectionalLight(0xffffff, 0.6);
      directionalLight.position.set(50, 50, 50);
      scene.add(directionalLight);

      // الأرضية
      const floorMaterial = new THREE.MeshPhongMaterial({ color: 0xdddddd, side: THREE.DoubleSide });
      const floorGeometry = new THREE.PlaneGeometry(landLength, landWidth);
      const floor = new THREE.Mesh(floorGeometry, floorMaterial);
      floor.rotation.x = -Math.PI/2;
      scene.add(floor);
    }

    function drawBuilding(landLength, landWidth, numRooms, numBathrooms, wallThickness, doorWidth) {
      const hallLength = landLength * 0.8;
      const hallWidth = landWidth * 0.6;
      const hallHeight = 5;

      // الصالة
      const hallGeom = new THREE.BoxGeometry(hallLength, hallHeight, hallWidth);
      const hallMat = new THREE.MeshPhongMaterial({ color: 0x00ff00, transparent:true, opacity:0.5 });
      const hall = new THREE.Mesh(hallGeom, hallMat);
      hall.position.set(hallLength/2, hallHeight/2, hallWidth/2 + (landWidth - hallWidth)/2);
      scene.add(hall);

      addLabel(hall, `الصالة\n${hallLength.toFixed(1)}×${hallWidth.toFixed(1)}`);

      const roomSize = 4;
      const bathroomSize = 2;
      let roomPositions = [];

      // الغرف
      for(let i=0; i<numRooms; i++) {
        let x = Math.random() * (landLength - roomSize);
        let z = Math.random() * (landWidth - roomSize);
        // منع تداخل الغرف
        let overlap = roomPositions.some(pos => Math.abs(pos.x-x)<roomSize && Math.abs(pos.z-z)<roomSize);
        if(overlap) { i--; continue; }
        roomPositions.push({x,z});
        const roomGeom = new THREE.BoxGeometry(roomSize, 5, roomSize);
        const roomMat = new THREE.MeshPhongMaterial({ color: 0x0000ff, transparent:true, opacity:0.5 });
        const room = new THREE.Mesh(roomGeom, roomMat);
        room.position.set(x+roomSize/2, 2.5, z+roomSize/2);
        scene.add(room);
        addLabel(room, `غرفة\n${roomSize}×${roomSize}`);
      }

      // الحمامات
      for(let i=0; i<numBathrooms; i++) {
        let x = Math.random() * (landLength - bathroomSize);
        let z = Math.random() * (landWidth - bathroomSize);
        let overlap = roomPositions.some(pos => Math.abs(pos.x-x)<bathroomSize && Math.abs(pos.z-z)<bathroomSize);
        if(overlap) { i--; continue; }
        roomPositions.push({x,z});
        const bathGeom = new THREE.BoxGeometry(bathroomSize, 5, bathroomSize);
        const bathMat = new THREE.MeshPhongMaterial({ color: 0xff0000, transparent:true, opacity:0.5 });
        const bath = new THREE.Mesh(bathGeom, bathMat);
        bath.position.set(x+bathroomSize/2, 2.5, z+bathroomSize/2);
        scene.add(bath);
        addLabel(bath, `حمام\n${bathroomSize}×${bathroomSize}`);
      }

      // القياسات
      let measurements = `
        <h2>القياسات:</h2>
        <p>الأرض: ${landLength}×${landWidth} م</p>
        <p>سمك الجدران: 0.2 م</p>
        <p>عرض الأبواب: 1 م</p>
        <p>عدد الغرف: ${numRooms}</p>
        <p>عدد الحمامات: ${numBathrooms}</p>
      `;
      measurementsDiv.innerHTML = measurements;
    }

    // إضافة نص فوق المجسمات
    function addLabel(obj, text) {
      const canvas = document.createElement('canvas');
      const size = 256;
      canvas.width = size;
      canvas.height = size;
      const context = canvas.getContext('2d');
      context.fillStyle = 'rgba(255,255,255,0.8)';
      context.fillRect(0,0,size,size);
      context.fillStyle = 'black';
      context.font = '28px Arial';
      context.textAlign = 'center';
      context.textBaseline = 'middle';
      const lines = text.split("\n");
      lines.forEach((line,i) => {
        context.fillText(line, size/2, size/2 + i*30 - 15);
      });

      const texture = new THREE.CanvasTexture(canvas);
      const spriteMaterial = new THREE.SpriteMaterial({ map: texture });
      const sprite = new THREE.Sprite(spriteMaterial);
      sprite.scale.set(obj.geometry.parameters.width, 3, 1);
      sprite.position.set(obj.position.x, obj.position.y+3, obj.position.z);
      scene.add(sprite);
    }

    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }
  </script>
</body>
</html>
