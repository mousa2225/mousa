<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مصمم تخطيط عمراني لصالة مبنى ضخم</title>

    <!-- مكتبات Three.js + أدوات التحكم -->
    <script type="module">
        import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.module.js';
        import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.128.0/examples/jsm/controls/OrbitControls.js';
        import { FontLoader } from 'https://cdn.jsdelivr.net/npm/three@0.128.0/examples/jsm/loaders/FontLoader.js';
        import { TextGeometry } from 'https://cdn.jsdelivr.net/npm/three@0.128.0/examples/jsm/geometries/TextGeometry.js';

        const form = document.getElementById('input-form');
        const sceneContainer = document.getElementById('scene-container');
        const measurementsDiv = document.getElementById('measurements');

        let scene, camera, renderer, controls;

        form.addEventListener('submit', function(event) {
            event.preventDefault();

            const landLength = parseFloat(document.getElementById('land-length').value);
            const landWidth = parseFloat(document.getElementById('land-width').value);
            const numRooms = parseInt(document.getElementById('num-rooms').value) || 0;
            const numBathrooms = parseInt(document.getElementById('num-bathrooms').value) || 0;

            const totalArea = landLength * landWidth;
            const hallArea = totalArea * 0.6;
            const hallLength = landLength * 0.8;
            const hallWidth = hallArea / hallLength;
            const roomSize = 4;
            const bathroomSize = 2;
            const wallThickness = 0.2;
            const doorWidth = 1;
            const roomsPerSide = Math.ceil(numRooms / 2);
            const bathroomsPerSide = Math.ceil(numBathrooms / 2);

            init3D(landLength, landWidth);
            drawBuilding(landLength, landWidth, hallLength, hallWidth,
                numRooms, numBathrooms, roomSize, bathroomSize,
                wallThickness, doorWidth, roomsPerSide, bathroomsPerSide);
            displayMeasurements(landLength, landWidth, hallLength, hallWidth,
                numRooms, numBathrooms, roomSize, bathroomSize, wallThickness, doorWidth);

            animate();
        });

        function init3D(landLength, landWidth) {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xe0e0e0);

            camera = new THREE.PerspectiveCamera(60, sceneContainer.clientWidth / 600, 0.1, 2000);
            camera.position.set(landLength * 0.6, 40, landWidth * 1.2);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(sceneContainer.clientWidth, 600);
            sceneContainer.innerHTML = '';
            sceneContainer.appendChild(renderer.domElement);

            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.target.set(landLength / 2, 0, landWidth / 2);
            controls.update();

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
            scene.add(ambientLight);
            const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
            dirLight.position.set(landLength, 50, landWidth);
            scene.add(dirLight);

            const floorGeometry = new THREE.PlaneGeometry(landLength * 2, landWidth * 2);
            const floorMaterial = new THREE.MeshStandardMaterial({ color: 0xcccccc, side: THREE.DoubleSide });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.position.y = 0;
            scene.add(floor);
        }

        function drawBuilding(landLength, landWidth, hallLength, hallWidth, numRooms, numBathrooms,
                              roomSize, bathroomSize, wallThickness, doorWidth, roomsPerSide, bathroomsPerSide) {

            // الصالة
            const hallGeometry = new THREE.BoxGeometry(hallLength, 5, hallWidth);
            const hallMaterial = new THREE.MeshLambertMaterial({ color: 0x55ff55, transparent: true, opacity: 0.4 });
            const hall = new THREE.Mesh(hallGeometry, hallMaterial);
            hall.position.set(hallLength / 2, 2.5, hallWidth / 2 + (landWidth - hallWidth) / 2);
            scene.add(hall);

            addText(`الصالة: ${hallLength.toFixed(1)}×${hallWidth.toFixed(1)}م`, hall.position.x, 6, hall.position.z);

            // الغرف
            const roomOffset = hallWidth / 2 + (landWidth - hallWidth) / 2 + roomSize / 2 + wallThickness;
            for (let i = 0; i < numRooms; i++) {
                const roomGeometry = new THREE.BoxGeometry(roomSize, 5, roomSize);
                const roomMaterial = new THREE.MeshLambertMaterial({ color: 0x5555ff, transparent: true, opacity: 0.5 });
                const room = new THREE.Mesh(roomGeometry, roomMaterial);
                room.position.set((i % roomsPerSide) * (roomSize + wallThickness) + roomSize / 2,
                                  2.5, i < roomsPerSide ? roomOffset : landWidth - roomOffset);
                scene.add(room);
                addText(`غرفة ${i + 1}`, room.position.x, 6, room.position.z);
            }

            // الحمامات
            const bathOffset = roomOffset + (numRooms > 0 ? roomSize + wallThickness : 0);
            for (let i = 0; i < numBathrooms; i++) {
                const bathGeometry = new THREE.BoxGeometry(bathroomSize, 5, bathroomSize);
                const bathMaterial = new THREE.MeshLambertMaterial({ color: 0xff5555, transparent: true, opacity: 0.5 });
                const bath = new THREE.Mesh(bathGeometry, bathMaterial);
                bath.position.set((i % bathroomsPerSide) * (bathroomSize + wallThickness) + bathroomSize / 2,
                                  2.5, i < bathroomsPerSide ? bathOffset : landWidth - bathOffset);
                scene.add(bath);
                addText(`حمام ${i + 1}`, bath.position.x, 6, bath.position.z);
            }

            // الجدران الخارجية (هيكل الأرض)
            const outlineGeometry = new THREE.EdgesGeometry(new THREE.BoxGeometry(landLength, 5, landWidth));
            const outlineMaterial = new THREE.LineBasicMaterial({ color: 0x000000 });
            const outline = new THREE.LineSegments(outlineGeometry, outlineMaterial);
            outline.position.set(landLength / 2, 2.5, landWidth / 2);
            scene.add(outline);
        }

        function addText(text, x, y, z) {
            const loader = new FontLoader();
            loader.load('https://threejs.org/examples/fonts/helvetiker_regular.typeface.json', function(font) {
                const geometry = new TextGeometry(text, {
                    font: font,
                    size: 0.8,
                    height: 0.1
                });
                const material = new THREE.MeshBasicMaterial({ color: 0x111111 });
                const mesh = new THREE.Mesh(geometry, material);
                mesh.position.set(x - text.length * 0.2, y, z);
                scene.add(mesh);
            });
        }

        function displayMeasurements(landLength, landWidth, hallLength, hallWidth,
                                     numRooms, numBathrooms, roomSize, bathroomSize, wallThickness, doorWidth) {
            let html = `
                <h2>القياسات الدقيقة:</h2>
                <p>مساحة الأرض: ${landLength} × ${landWidth} = ${(landLength * landWidth).toFixed(1)} م²</p>
                <p>الصالة: ${hallLength.toFixed(1)} × ${hallWidth.toFixed(1)} م</p>
                <p>الجدران: ${wallThickness} م | الأبواب: ${doorWidth} م</p>`;
            if (numRooms > 0) html += `<p>الغرف: ${numRooms} (كل غرفة ${roomSize} × ${roomSize} م)</p>`;
            if (numBathrooms > 0) html += `<p>الحمامات: ${numBathrooms} (كل حمام ${bathroomSize} × ${bathroomSize} م)</p>`;
            measurementsDiv.innerHTML = html;
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
    </script>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            padding: 20px;
            direction: rtl;
            text-align: center;
        }
        form {
            max-width: 600px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        label { display: block; margin-bottom: 8px; text-align: right; }
        input { width: 100%; padding: 8px; margin-bottom: 12px; border: 1px solid #ccc; border-radius: 4px; }
        button { background: #4CAF50; color: #fff; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; }
        button:hover { background: #45a049; }
        #scene-container { width: 100%; height: 600px; margin-top: 20px; background: #ddd; border-radius: 6px; }
        #measurements {
            max-width: 600px;
            margin: 20px auto;
            background: #fff;
            padding: 15px;
            border-radius: 8px;
            text-align: right;
        }
    </style>
</head>

<body>
    <h1>مصمم تخطيط عمراني لصالة مبنى ضخم</h1>

    <form id="input-form">
        <label for="land-length">طول الأرض (متر):</label>
        <input type="number" id="land-length" min="10" step="0.1" required>

        <label for="land-width">عرض الأرض (متر):</label>
        <input type="number" id="land-width" min="10" step="0.1" required>

        <label for="num-rooms">عدد الغرف:</label>
        <input type="number" id="num-rooms" min="0" step="1">

        <label for="num-bathrooms">عدد الحمامات:</label>
        <input type="number" id="num-bathrooms" min="0" step="1">

        <button type="submit">إنشاء المخطط</button>
    </form>

    <div id="scene-container"></div>
    <div id="measurements"></div>
</body>
</html>
