<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>حاسبة تحويل الباقات</title>
  <link href="https://fonts.googleapis.com/css2?family=Rakkas&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #e0f7fa;
      padding: 30px;
      direction: rtl;
    }
    .container {
      background: #fff;
      padding: 25px;
      border-radius: 15px;
      max-width: 800px;
      margin: auto;
      box-shadow: 0 6px 18px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: #0288d1;
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin: 12px 0 6px;
      font-weight: bold;
      color: #37474f;
    }
    input, select {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #b0bec5;
      margin-bottom: 15px;
      font-size: 15px;
    }
    button {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 10px;
    }
    button.calculate {
      background: #0288d1;
      color: white;
    }
    button.print {
      background: #f57c00;
      color: white;
    }
    button.pdf {
      background: #4caf50;
      color: white;
    }
    .results {
      margin-top: 25px;
      padding: 20px;
      background: #fafafa;
      border: 1px solid #cfd8dc;
      border-radius: 10px;
      display: none;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    table, th, td {
      border: 1px solid #b0bec5;
    }
    th {
      background: #0288d1;
      color: white;
      padding: 10px;
    }
    td {
      padding: 10px;
      text-align: center;
    }
    .positive { color: green; font-weight: bold; }
    .negative { color: red; font-weight: bold; }
    .signature {
      margin-top: 20px;
      font-family: 'Rakkas', cursive;
      font-size: 22px;
      text-align: center;
      color: #37474f;
    }
    /* الطباعة */
    @media print {
      body { background: white; }
      .container { box-shadow: none; border: none; }
      button { display: none; }
      .results { display: block; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>حاسبة تحويل الباقات</h1>
    <label>سعر الباقة الحالية:</label>
    <input type="number" id="oldPrice" placeholder="أدخل السعر الحالي">
    
    <label>الأيام المتبقية:</label>
    <input type="number" id="oldDays" placeholder="أدخل الأيام المتبقية">
    
    <label>سعر الباقة الجديدة:</label>
    <input type="number" id="newPrice" placeholder="أدخل السعر الجديد">
    
    <label>مدة الباقة الجديدة (أيام):</label>
    <input type="number" id="newDays" placeholder="أدخل المدة الجديدة">
    
    <button class="calculate" onclick="calculate()">احسب</button>
    <button class="print" onclick="window.print()">🖨️ طباعة</button>
    <button class="pdf" onclick="downloadPDF()">⬇️ تنزيل PDF</button>
    
    <div class="results" id="results">
      <h2>الملخص</h2>
      <table>
        <tr><th>الوصف</th><th>القيمة</th></tr>
        <tr><td>المبلغ المسترجع</td><td id="refund"></td></tr>
        <tr><td>سعر الباقة الجديدة</td><td id="newPackage"></td></tr>
        <tr><td>المبلغ المطلوب/المتبقي</td><td id="finalAmount"></td></tr>
      </table>
      <div class="signature">التوقيع: ...................</div>
    </div>
  </div>

  <!-- مكتبة PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script>
    function calculate() {
      let oldPrice = parseFloat(document.getElementById("oldPrice").value) || 0;
      let oldDays = parseFloat(document.getElementById("oldDays").value) || 0;
      let newPrice = parseFloat(document.getElementById("newPrice").value) || 0;
      let newDays = parseFloat(document.getElementById("newDays").value) || 0;

      let refund = (oldPrice / 30) * oldDays;
      let finalAmount = newPrice - refund;

      document.getElementById("refund").innerHTML = refund.toFixed(2) + " ريال";
      document.getElementById("newPackage").innerHTML = newPrice.toFixed(2) + " ريال";
      document.getElementById("finalAmount").innerHTML = 
        (finalAmount >= 0 ? `<span class='positive'>${finalAmount.toFixed(2)} ريال (مطلوب)</span>` 
                          : `<span class='negative'>${Math.abs(finalAmount).toFixed(2)} ريال (متبقي)</span>`);

      document.getElementById("results").style.display = "block";
    }

    function downloadPDF() {
      var element = document.querySelector(".results"); // الملخص فقط
      var opt = {
        margin:       0.5,
        filename:     'ملخص-تحويل-الباقات.pdf',
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
      };
      html2pdf().set(opt).from(element).save();
    }
  </script>
</body>
</html>
