<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>حاسبة الاسترداد اليومي</title>
<style>
/* ======================== إعدادات عامة ======================== */
body {
  font-family: "Tahoma", Arial, sans-serif;
  background: linear-gradient(180deg, #e0f7fa 0%, #ffffff 100%);
  margin: 0;
  padding: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
  box-sizing: border-box;
}
h1 {
  color: #0288d1;
  text-align: center;
  margin-bottom: 25px;
  font-size: 24px;
}

/* ======================== حاوية الادخالات ======================== */
.container {
  width: 100%;
  max-width: 480px;
  background: #fff;
  border-radius: 14px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  padding: 20px;
  box-sizing: border-box;
  margin-bottom: 20px;
}
label {
  font-weight: bold;
  color: #00796b;
  font-size: 14px;
  margin-top: 10px;
}
input, select {
  width: 100%;
  padding: 10px;
  margin-top: 5px;
  border: 2px solid #03a9f4;
  border-radius: 6px;
  font-size: 14px;
  text-align: center;
  transition: 0.3s;
  box-sizing: border-box;
}
input:focus, select:focus {
  border-color: #0288d1;
  background-color: #e1f5fe;
  outline: none;
}
button {
  width: 100%;
  background-color: #03a9f4;
  color: white;
  border: none;
  padding: 10px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 15px;
  font-weight: bold;
  margin-top: 10px;
  transition: 0.3s;
}
button:hover {
  background-color: #0288d1;
}
button.delete {
  background-color: #f44336;
  font-size: 13px;
  padding: 6px 8px;
}

/* رسالة نجاح */
.success-message {
  color: green;
  font-weight: bold;
  text-align: center;
  display: none;
  margin-top: 10px;
  font-size: 14px;
}
.success-message::before { content: "✔ "; }

/* ======================== جدول العملاء ======================== */
.table-wrapper {
  width: 100%;
  overflow-x: auto;
  margin-top: 20px;
}
table {
  width: 100%;
  min-width: 400px;
  border-collapse: collapse;
  text-align: center;
  font-size: 13px;
}
th, td {
  border: 1px solid #03a9f4;
  padding: 8px;
  text-align: center;
}
th {
  background-color: #2196f3;
  color: white;
}
tr:nth-child(even) td {
  background-color: #e1bee7;
}

/* ======================== استجابة الأجهزة الصغيرة ======================== */
@media (max-width: 600px) {
  body { padding: 10px; }
  h1 { font-size: 20px; }
  .container { padding: 15px; }
  button { font-size: 14px; }
  table { font-size: 12px; }
}

/* ======================== نافذة العميل الاستثنائي ======================== */
.modal {
  display: none;
  position: fixed;
  z-index: 999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.5);
}
.modal-content {
  background-color: #fff;
  margin: 5% auto;
  padding: 20px;
  border-radius: 14px;
  max-width: 480px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  position: relative;
  display: flex;
  flex-direction: column;
}
.close {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 22px;
  font-weight: bold;
  cursor: pointer;
  color:#f44336;
}

/* ======================== توقيع المحاسب ======================== */
.signature {
  margin-top: 30px;
  font-family: 'Brush Script MT', cursive, sans-serif;
  font-size: 26px;
  color: #2c3e50;
  text-align: right;
  font-style: italic;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
}
</style>
</head>

<body>
<h1>حاسبة الاسترداد اليومي</h1>

<div class="container">
  <div class="success-message" id="successMsg">تم حفظ العميل بنجاح</div>

  <label>اسم العميل</label>
  <input type="text" id="clientName">

  <label>رقم العميل</label>
  <input type="text" id="clientNumber">

  <label>قيمة الباقة</label>
  <input type="number" id="packageValue">

  <label>عدد أيام الباقة الأساسية</label>
  <input type="number" id="packageDays">

  <label>عدد الأيام المستفاد بها</label>
  <input type="number" id="daysUsed">

  <label>اسم البنك</label>
  <input type="text" id="bankName">

  <label>رقم الحساب البنكي</label>
  <input type="text" id="bankAccount">

  <label>نوع الاشتراك</label>
  <select id="subscriptionType">
    <option value="" disabled selected hidden>اختر نوع الاشتراك</option>
    <option value="تطبيق جديد">تطبيق جديد</option>
    <option value="تطبيق تجديد">تطبيق تجديد</option>
    <option value="جديد يدوي">جديد يدوي</option>
    <option value="تجديد يدوي">تجديد يدوي</option>
  </select>

  <label>الملاحظات</label>
  <input type="text" id="notes">

  <!-- زر جديد يجمع الحفظ + الحساب -->
  <button onclick="addClientAndCalculate()">💾 حفظ وحساب الاسترداد</button>
  <button onclick="openExceptionalModal()">🌟 إضافة عميل استثنائي</button>

  <div class="signature">Accountant Mousa Muhammad</div>
</div>

<!-- نافذة العميل الاستثنائي -->
<div id="exceptionalModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeExceptionalModal()">&times;</span>
    <h2>إضافة عميل استثنائي</h2>
    <label>اسم العميل</label>
    <input type="text" id="exceptionalName">
    <label>رقم العميل</label>
    <input type="text" id="exceptionalNumber">
    <label>قيمة الباقة</label>
    <input type="number" id="exceptionalPackageValue">
    <label>عدد الأيام في الباقة</label>
    <input type="number" id="exceptionalPackageDays">
    <label>عدد الأيام المستفاد بها</label>
    <input type="number" id="exceptionalDaysUsed">
    <label>اسم البنك</label>
    <input type="text" id="exceptionalBank">
    <label>رقم الحساب البنكي</label>
    <input type="text" id="exceptionalAccount">
    <label>نوع الاشتراك</label>
    <select id="exceptionalType">
      <option value="" disabled selected hidden>اختر نوع الاشتراك</option>
      <option value="تطبيق جديد">تطبيق جديد</option>
      <option value="تطبيق تجديد">تطبيق تجديد</option>
      <option value="جديد يدوي">جديد يدوي</option>
      <option value="تجديد يدوي">تجديد يدوي</option>
    </select>
    <label>المبلغ المسترد يدويًا</label>
    <input type="number" id="exceptionalRefund">
    <label>الملاحظات</label>
    <input type="text" id="exceptionalNotes">
    <button onclick="saveExceptionalClient()">💾 حفظ العميل الاستثنائي</button>
  </div>
</div>

<!-- جدول العملاء -->
<div class="table-wrapper">
  <table id="clientsTable">
    <tr>
      <th>اسم العميل</th>
      <th>قيمة الباقة (عدد الأيام)</th>
      <th>المبلغ المسترد</th>
      <th>حذف</th>
    </tr>
  </table>
</div>

<button onclick="exportToExcel()">📥 إصدار ملف Excel</button>

<script>
let clients = [];

/* دمج الحفظ + الحساب */
function addClientAndCalculate() {
  const name = clientName.value.trim();
  const number = clientNumber.value.trim();
  const value = parseFloat(packageValue.value);
  const totalDays = parseFloat(packageDays.value);
  const used = parseFloat(daysUsed.value);
  const bank = bankName.value.trim();
  const account = bankAccount.value.trim();
  const type = subscriptionType.value;
  const notes = notesInput.value.trim();

  if (!name || !number) return alert("الرجاء إدخال اسم ورقم العميل");
  if (used > totalDays) return alert("عدد الأيام المستفاد بها لا يمكن أن يتجاوز عدد الأيام الكلي");

  const refund = ((value / totalDays) * (totalDays - used)).toFixed(2);

  clients.push({ name, number, packageValue: value, packageDays: totalDays, daysUsed: used, bank, account, type, notes, refund, exceptional: false });
  renderTable();
  successMsg.style.display = 'block';
  setTimeout(()=> successMsg.style.display='none',2000);
  document.querySelectorAll('.container input').forEach(i=>i.value='');
}

/* باقي الدوال كما هي تمامًا */
function openExceptionalModal(){ exceptionalModal.style.display='block'; }
function closeExceptionalModal(){ exceptionalModal.style.display='none'; }
function saveExceptionalClient(){
  const name = exceptionalName.value.trim();
  const number = exceptionalNumber.value.trim();
  const refund = parseFloat(exceptionalRefund.value);
  if (!name || !number || isNaN(refund)) return alert("الرجاء إدخال الاسم والرقم والمبلغ المسترد");
  clients.push({ name, number, refund: refund.toFixed(2), exceptional:true });
  closeExceptionalModal();
  renderTable();
}
function renderTable(){
  const table=document.getElementById("clientsTable");
  table.innerHTML=`<tr><th>اسم العميل</th><th>قيمة الباقة (عدد الأيام)</th><th>المبلغ المسترد</th><th>حذف</th></tr>`;
  clients.forEach((c,i)=>{
    table.innerHTML+=`<tr ${c.exceptional?'style="background-color:#fff3e0;"':''}>
    <td>${c.name}</td><td>${c.packageValue||'-'} (${c.packageDays||'-'})</td><td>${c.refund||'-'}</td>
    <td><button class="delete" onclick="deleteClient(${i})">🗑️</button></td></tr>`;
  });
}
function deleteClient(i){ if(confirm("هل أنت متأكد؟")){clients.splice(i,1);renderTable();}}
function exportToExcel(){ /* كما هو من كودك الأصلي */ }
</script>
</body>
</html>
