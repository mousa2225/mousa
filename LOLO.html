<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø§Ù„ÙŠ - Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</title>
<style>
  body {
    font-family: 'Cairo', sans-serif;
    background: linear-gradient(135deg, #fff8f0, #ffe0b2, #ffccbc);
    color: #333;
    padding: 30px;
  }
  h2 {
    text-align: center;
    color: #d84315;
    margin-bottom: 25px;
  }
  .calculator {
    background: #ffffffcc;
    padding: 25px;
    border-radius: 14px;
    max-width: 850px;
    margin: auto;
    box-shadow: 0 6px 18px rgba(0,0,0,0.15);
    backdrop-filter: blur(5px);
  }
  .client-section {
    background: linear-gradient(135deg, #fff3e0, #ffe0b2);
    padding: 15px;
    border-radius: 12px;
    margin-bottom: 15px;
    position: relative;
    transition: all 0.4s ease;
    border: 1px solid #ffb74d;
  }
  .client-section:hover {
    background: linear-gradient(135deg, #ffccbc, #ffe0b2);
    transform: scale(1.01);
  }
  .client-section h3 {
    color: #e65100;
    margin-bottom: 10px;
  }
  label {
    display: block;
    margin-top: 10px;
    font-weight: bold;
    color: #bf360c;
  }
  input {
    width: 100%;
    padding: 8px;
    margin-top: 4px;
    border: 1px solid #ffcc80;
    border-radius: 8px;
    font-size: 15px;
  }
  .remove-btn {
    position: absolute;
    top: 10px;
    left: 10px;
    background: #e53935;
    color: white;
    border: none;
    border-radius: 50%;
    width: 26px;
    height: 26px;
    font-weight: bold;
    cursor: pointer;
  }
  button {
    background: #ef6c00;
    border: none;
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    margin: 10px 5px;
  }
  button:hover { background: #e65100; }
  .add-btn {
    background: #ff7043;
  }
  .add-btn:hover { background: #f4511e; }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 25px;
  }
  th, td {
    border: 2px solid #f57c00;
    padding: 10px;
    text-align: center;
    font-size: 17px;
  }
  th {
    background-color: #ffb74d;
    color: #4e342e;
    font-weight: bold;
  }
  td {
    background: #fff8f0;
  }
  .signature {
    margin-top: 25px;
    text-align: left;
    color: #6d4c41;
    font-weight: bold;
    font-size: 20px;
  }
  .signature span {
    color: #ef6c00;
    font-size: 22px;
  }
</style>
</head>
<body>

<div class="calculator">
  <h2>ğŸ“Š Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø§Ù„ÙŠ Ù„Ø¹Ø¯Ø© Ø¹Ù…Ù„Ø§Ø¡</h2>

  <div id="clientsContainer"></div>

  <button class="add-btn" onclick="addClient()">â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„</button>
  <button onclick="calculateAll()">ğŸ’° Ø§Ø­Ø³Ø¨ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</button>
  <button onclick="exportToExcel()">ğŸ“¤ Ø¥ØµØ¯Ø§Ø± Ù…Ù„Ù Excel</button>

  <div class="result-section" id="results"></div>
  <div class="signature">âœ’ï¸ <span>Accountant Mousa</span></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.19.3/xlsx.full.min.js"></script>
<script>
let clientCount = 0;

function addClient() {
  clientCount++;
  const clientHTML = `
  <div class="client-section" id="client-${clientCount}">
    <button class="remove-btn" onclick="removeClient(${clientCount})">Ã—</button>
    <h3>ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ ${clientCount}</h3>
    
    <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</label>
    <input type="text" id="name-${clientCount}" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯">

    <label>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</label>
    <input type="text" id="number-${clientCount}" placeholder="Ù…Ø«Ø§Ù„: 0551234567">

    <label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø´ØªØ±Ùƒ Ø¹Ù„ÙŠÙ‡Ø§ (Ø±ÙŠØ§Ù„):</label>
    <input type="number" id="price-${clientCount}" placeholder="Ù…Ø«Ø§Ù„: 1295">

    <label>Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø¨Ø§Ù‚Ø©:</label>
    <input type="number" id="days-${clientCount}" placeholder="Ù…Ø«Ø§Ù„: 24">

    <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³ØªÙØ§Ø¯ Ø¨Ù‡Ø§:</label>
    <input type="number" id="used-${clientCount}" placeholder="Ù…Ø«Ø§Ù„: 19">

    <label>Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ:</label>
    <input type="text" id="bank-${clientCount}" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ">

    <label>Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ:</label>
    <input type="text" id="iban-${clientCount}" placeholder="Ù…Ø«Ø§Ù„: SA12300001234567890">

    <label>Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:</label>
    <input type="text" id="type-${clientCount}" placeholder="Ù…Ø«Ø§Ù„: Ø´Ù‡Ø±ÙŠ">

    <label>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
    <input type="text" id="note-${clientCount}" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
  </div>`;
  document.getElementById("clientsContainer").insertAdjacentHTML("beforeend", clientHTML);
}

function removeClient(id) {
  const el = document.getElementById(`client-${id}`);
  if (el) el.remove();
}

function calculateAll() {
  const clients = document.querySelectorAll(".client-section");
  if (clients.length === 0) {
    alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.");
    return;
  }

  let tableHTML = `
  <table>
    <tr>
      <th>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
      <th>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø´ØªØ±Ùƒ Ø¹Ù„ÙŠÙ‡Ø§</th>
      <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³ØªÙØ§Ø¯ Ø¨Ù‡Ø§</th>
      <th>Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ</th>
      <th>Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</th>
      <th>Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th>
      <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ±Ø¯</th>
      <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
    </tr>`;

  clients.forEach((client) => {
    const id = client.id.split('-')[1];
    const name = getValue(`name-${id}`);
    const number = getValue(`number-${id}`);
    const price = parseFloat(getValue(`price-${id}`)) || 0;
    const totalDays = parseFloat(getValue(`days-${id}`)) || 0;
    const used = parseFloat(getValue(`used-${id}`)) || 0;
    const bank = getValue(`bank-${id}`);
    const iban = getValue(`iban-${id}`);
    const type = getValue(`type-${id}`);
    const note = getValue(`note-${id}`);

    const remaining = totalDays - used;
    const dailyRate = totalDays > 0 ? price / totalDays : 0;
    const refund = remaining * dailyRate;

    tableHTML += `
    <tr>
      <td>${number}</td>
      <td>${price.toFixed(2)} (${totalDays})</td>
      <td>${used}</td>
      <td>${bank}</td>
      <td>${iban}</td>
      <td>${type}</td>
      <td style="color:${refund>0?'#2e7d32':'#d32f2f'}; font-weight:bold;">${refund.toFixed(2)}</td>
      <td>${note}</td>
    </tr>`;
  });

  tableHTML += `</table>`;
  document.getElementById("results").innerHTML = tableHTML;
}

function getValue(id) {
  return document.getElementById(id)?.value || "";
}

function exportToExcel() {
  const rows = [];
  const headers = [
    "Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„",
    "Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø´ØªØ±Ùƒ Ø¹Ù„ÙŠÙ‡Ø§ (Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…)",
    "Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³ØªÙØ§Ø¯ Ø¨Ù‡Ø§",
    "Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ",
    "Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ",
    "Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ",
    "Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ±Ø¯",
    "Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª"
  ];
  rows.push(headers);

  const clients = document.querySelectorAll(".client-section");
  clients.forEach((client) => {
    const id = client.id.split('-')[1];
    const number = getValue(`number-${id}`);
    const price = parseFloat(getValue(`price-${id}`)) || 0;
    const totalDays = parseFloat(getValue(`days-${id}`)) || 0;
    const used = parseFloat(getValue(`used-${id}`)) || 0;
    const bank = getValue(`bank-${id}`);
    const iban = getValue(`iban-${id}`);
    const type = getValue(`type-${id}`);
    const note = getValue(`note-${id}`);

    const remaining = totalDays - used;
    const dailyRate = totalDays > 0 ? price / totalDays : 0;
    const refund = remaining * dailyRate;

    rows.push([
      number,
      `${price.toFixed(2)} (${totalDays})`,
      used,
      bank,
      iban,
      type,
      refund.toFixed(2),
      note
    ]);
  });

  const ws = XLSX.utils.aoa_to_sheet(rows);

  // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø®Ø· ÙˆØ§Ù„Ø¹Ø±Ø¶
  const range = XLSX.utils.decode_range(ws['!ref']);
  for(let C = range.s.c; C <= range.e.c; ++C) {
    ws['!cols'] = ws['!cols'] || [];
    ws['!cols'][C] = { wch: 25 }; // Ø¹Ø±Ø¶ Ø£Ø¹Ø±Ø¶
  }

  for(let R = range.s.r; R <= range.e.r; ++R) {
    for(let C = range.s.c; C <= range.e.c; ++C) {
      const cellAddress = XLSX.utils.encode_cell({r:R, c:C});
      const cell = ws[cellAddress];
      if (cell) {
        cell.s = {
          font: { bold: R === 0, sz: 16 },
          alignment: { horizontal: "center", vertical: "center" },
          border: {
            top: { style: "thin", color: { rgb: "000000" } },
            bottom: { style: "thin", color: { rgb: "000000" } },
            left: { style: "thin", color: { rgb: "000000" } },
            right: { style: "thin", color: { rgb: "000000" } }
          },
          fill: R === 0 ? { fgColor: { rgb: "FFE0B2" } } : {}
        };
      }
    }
  }

  const today = new Date();
  today.setDate(today.getDate() - 1);
  const dateStr = today.toLocaleDateString('ar-EG', { day: 'numeric', month: 'long' });
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ");
  XLSX.writeFile(wb, `Ù…Ù„Ù Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ ${dateStr}.xlsx`);
}
</script>
</body>
</html>
