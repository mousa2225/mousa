<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø§Ù„ÙŠ - Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</title>
<style>
  body {
    font-family: 'Cairo', sans-serif;
    background-color: #f0f6fa;
    color: #333;
    padding: 20px;
  }
  h2 {
    text-align: center;
    color: #1565c0;
    margin-bottom: 20px;
  }
  .calculator {
    background: #fff;
    padding: 20px;
    border-radius: 14px;
    max-width: 1000px;
    margin: auto;
    box-shadow: 0 6px 18px rgba(0,0,0,0.1);
  }
  .client-section {
    background: #e3f2fd;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 15px;
    position: relative;
  }
  .client-section h3 {
    color: #0d47a1;
    margin-bottom: 10px;
  }
  label {
    display: block;
    margin-top: 10px;
    font-weight: bold;
    color: #0d47a1;
  }
  input {
    width: 100%;
    padding: 8px;
    margin-top: 4px;
    border: 1px solid #bbdefb;
    border-radius: 8px;
    font-size: 15px;
  }
  .remove-btn {
    position: absolute;
    top: 10px;
    left: 10px;
    background: #e53935;
    color: white;
    border: none;
    border-radius: 50%;
    width: 26px;
    height: 26px;
    font-weight: bold;
    cursor: pointer;
  }
  button {
    background: #1e88e5;
    border: none;
    color: white;
    padding: 10px 18px;
    border-radius: 8px;
    font-size: 15px;
    cursor: pointer;
    margin: 5px 5px 10px 0;
  }
  button:hover { background: #1565c0; }
  .add-btn { background: #43a047; }
  .add-btn:hover { background: #2e7d32; }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
  }
  th, td {
    border: 1px solid #bbdefb;
    padding: 10px;
    text-align: center;
    font-size: 14px;
  }
  th { background-color: #1e88e5; color: white; }
  td { background: #f9fcff; }
  tr:nth-child(even) td { background: #e8f0fe; }
</style>
</head>
<body>

<div class="calculator">
  <h2>ğŸ“Š Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø§Ù„ÙŠ Ù„Ø¹Ø¯Ø© Ø¹Ù…Ù„Ø§Ø¡</h2>

  <div id="clientsContainer"></div>

  <button class="add-btn" onclick="addClient()">â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„</button>
  <button onclick="calculateAll()">ğŸ’° Ø§Ø­Ø³Ø¨ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</button>
  <button onclick="copyRows()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (Ø«Ù„Ø§Ø« Ø®Ø§Ù†Ø§Øª ÙÙ‚Ø·)</button>
  <button onclick="exportExcel()">ğŸ“¥ ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel</button>

  <div class="result-section" id="results"></div>
</div>

<script>
let clientCount = 0;

function addClient() {
  clientCount++;
  const clientHTML = `
  <div class="client-section" id="client-${clientCount}">
    <button class="remove-btn" onclick="removeClient(${clientCount})">Ã—</button>
    <h3>ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ ${clientCount}</h3>
    <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</label>
    <input type="text" id="name-${clientCount}" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯">
    <label>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</label>
    <input type="text" id="id-${clientCount}" placeholder="Ù…Ø«Ø§Ù„: 123456">
    <label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø´ØªØ±Ùƒ Ø¹Ù„ÙŠÙ‡Ø§ (Ø±ÙŠØ§Ù„):</label>
    <input type="number" id="price-${clientCount}" placeholder="Ù…Ø«Ø§Ù„: 1295">
    <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³ØªÙØ§Ø¯ Ø¨Ù‡Ø§:</label>
    <input type="number" id="used-${clientCount}" placeholder="Ù…Ø«Ø§Ù„: 19">
    <label>Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ:</label>
    <input type="text" id="bank-${clientCount}" placeholder="Ù…Ø«Ø§Ù„: Alinma">
    <label>Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ:</label>
    <input type="text" id="account-${clientCount}" placeholder="Ù…Ø«Ø§Ù„: 1234567890">
    <label>Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ:</label>
    <input type="text" id="subscription-${clientCount}" placeholder="Ù…Ø«Ø§Ù„: Ø´Ù‡Ø±ÙŠØ©">
    <label>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
    <input type="text" id="notes-${clientCount}" placeholder="Ù…Ø«Ø§Ù„: Ø¨Ø¯ÙˆÙ† Ù…Ù„Ø§Ø­Ø¸Ø§Øª">
  </div>`;
  document.getElementById("clientsContainer").insertAdjacentHTML("beforeend", clientHTML);
}

function removeClient(id) {
  const el = document.getElementById(`client-${id}`);
  if (el) el.remove();
}

function calculateAll() {
  const container = document.getElementById("clientsContainer");
  const clients = container.querySelectorAll(".client-section");
  if (clients.length === 0) { alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„."); return; }

  let tableHTML = `
  <table id="resultTable">
    <tr>
      <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
      <th>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
      <th>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø´ØªØ±Ùƒ Ø¹Ù„ÙŠÙ‡Ø§</th>
      <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³ØªÙØ§Ø¯ Ø¨Ù‡Ø§</th>
      <th>Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ</th>
      <th>Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</th>
      <th>Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th>
      <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ±Ø¯</th>
      <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
    </tr>`;

  clients.forEach((client) => {
    const name = client.querySelector('input[id^="name-"]').value || "";
    const id = client.querySelector('input[id^="id-"]').value || "";
    const price = parseFloat(client.querySelector('input[id^="price-"]')?.value) || 0;
    const used = parseFloat(client.querySelector('input[id^="used-"]')?.value) || 0;
    const bank = client.querySelector('input[id^="bank-"]').value || "";
    const account = client.querySelector('input[id^="account-"]').value || "";
    const subscription = client.querySelector('input[id^="subscription-"]').value || "";
    const notes = client.querySelector('input[id^="notes-"]').value || "";

    const refund = price - ((price / 30) * used);

    tableHTML += `
    <tr>
      <td>${name}</td>
      <td>${id}</td>
      <td>${price.toFixed(2)}</td>
      <td>${used}</td>
      <td>${bank}</td>
      <td>${account}</td>
      <td>${subscription}</td>
      <td style="color:${refund>0?'#2e7d32':'#d32f2f'}; font-weight:bold;">${refund.toFixed(2)}</td>
      <td>${notes}</td>
    </tr>`;
  });

  tableHTML += `
    <tr>
      <td colspan="9" style="text-align:right; font-weight:bold; font-style:italic; color:#FF5722; padding:15px;">
        Accountant Mousa
      </td>
    </tr>`;

  tableHTML += `</table>`;
  document.getElementById("results").innerHTML = tableHTML;
}

function copyRows() {
  const table = document.getElementById("resultTable");
  if (!table) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ù†Ø³Ø®!");
  let rowsText = "";
  for (let i = 1; i < table.rows.length - 1; i++) {
    const cells = table.rows[i].cells;
    // Ù†Ø³Ø® ÙÙ‚Ø· 3 Ø®Ø§Ù†Ø§Øª: Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø§Ù‚Ø©ØŒ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³ØªÙØ§Ø¯ Ø¨Ù‡Ø§ØŒ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ±Ø¯
    rowsText += cells[2].innerText + "\t" + cells[3].innerText + "\t" + cells[7].innerText + "\n";
  }
  navigator.clipboard.writeText(rowsText).then(() => alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!")).catch(() => alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®."));
}

function exportExcel() {
  const table = document.getElementById("resultTable");
  if (!table) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±!");

  // Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø³Ø§Ø¨Ù‚
  const today = new Date();
  const yesterday = new Date(today);
  yesterday.setDate(today.getDate() - 1);
  const day = yesterday.getDate();
  const monthNames = ["ÙŠÙ†Ø§ÙŠØ±","ÙØ¨Ø±Ø§ÙŠØ±","Ù…Ø§Ø±Ø³","Ø§Ø¨Ø±ÙŠÙ„","Ù…Ø§ÙŠÙˆ","ÙŠÙˆÙ†ÙŠÙˆ","ÙŠÙˆÙ„ÙŠÙˆ","Ø§ØºØ³Ø·Ø³","Ø³Ø¨ØªÙ…Ø¨Ø±","Ø§ÙƒØªÙˆØ¨Ø±","Ù†ÙˆÙÙ…Ø¨Ø±","Ø¯ÙŠØ³Ù…Ø¨Ø±"];
  const month = monthNames[yesterday.getMonth()];

  const fileName = `Ù…Ù„Ù Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ ${day} ${month}.xls`;

  // Ø¬Ø¯ÙˆÙ„ Excel Ù…Ù†Ø³Ù‚ ÙˆØ¬Ù…ÙŠÙ„
  let html = `
  <table border='1' style='border-collapse:collapse; font-family:Arial; font-size:11px; width:120%;'>
    <thead>
      <tr style='background-color:#4CAF50; color:white; font-weight:bold;'>
        <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
        <th>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
        <th>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ù…Ø´ØªØ±Ùƒ Ø¹Ù„ÙŠÙ‡Ø§</th>
        <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³ØªÙØ§Ø¯ Ø¨Ù‡Ø§</th>
        <th>Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ</th>
        <th>Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</th>
        <th>Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th>
        <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ±Ø¯</th>
        <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
      </tr>
    </thead>
    <tbody>`;

  for (let i = 1; i < table.rows.length - 1; i++) {
    const row = table.rows[i];
    html += `<tr style='font-weight:bold; font-size:11px;'>`;
    for (let j = 0; j < row.cells.length; j++) {
      html += `<td>${row.cells[j].innerText}</td>`;
    }
    html += `</tr>`;
  }

  // ØªÙˆÙ‚ÙŠØ¹
  html += `
    <tr>
      <td colspan="9" style="text-align:right; font-weight:bold; font-style:italic; color:#FF5722; padding:10px;">
        Accountant Mousa
      </td>
    </tr>`;

  html += `</tbody></table>`;

  const blob = new Blob([html], { type: "application/vnd.ms-excel" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = fileName;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}
</script>

</body>
</html>
