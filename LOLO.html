<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>حاسبة الاسترداد اليومي</title>
<style>
  body {
    font-family: "Tahoma", sans-serif;
    background: #eaf6ff;
    padding: 20px;
    text-align: center;
  }

  h1 {
    color: #004080;
    margin-bottom: 25px;
  }

  .form-container {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    max-width: 500px;
    margin: 0 auto 30px;
    padding: 25px;
    display: flex;
    flex-direction: column;
    gap: 15px;
    text-align: right;
  }

  label {
    font-weight: bold;
    color: #004b8d;
    display: block;
    margin-bottom: 5px;
  }

  input, select {
    width: 100%;
    padding: 10px;
    border: 2px solid #4fa3d1;
    border-radius: 8px;
    font-size: 15px;
    text-align: center;
    transition: 0.3s;
  }

  input:focus, select:focus {
    background-color: #e0f0ff;
    border-color: #1a73e8;
    outline: none;
  }

  .button-group {
    display: flex;
    justify-content: flex-start;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 10px;
  }

  button {
    flex: 1;
    background-color: #1a73e8;
    color: white;
    border: none;
    padding: 10px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 15px;
    transition: 0.3s;
  }

  button:hover {
    background-color: #155ab6;
  }

  button.calculate {
    background-color: #00bfff;
    font-size: 14px;
    padding: 8px 12px;
  }

  button.calculate:hover {
    background-color: #0099cc;
  }

  button.export {
    background-color: #00aaff;
  }

  button.export:hover {
    background-color: #008ecc;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 25px;
    border: 2px solid #cdddfc;
    background-color: white;
    border-radius: 10px;
    overflow: hidden;
    table-layout: fixed;
    word-wrap: break-word;
  }

  th, td {
    border: 1px solid #e2edff;
    padding: 12px;
    text-align: center;
    font-size: 15px;
  }

  th {
    background-color: #1a73e8;
    color: white;
  }

  tr:nth-child(even) td {
    background-color: #f6faff;
  }

  .signature {
    margin-top: 30px;
    text-align: left;
    font-weight: bold;
    font-size: 17px;
    color: #004080;
    font-style: italic;
  }

  .signature::after {
    content: " ___________________";
    color: #007bff;
  }
</style>
</head>
<body>

<h1>حاسبة الاسترداد اليومي</h1>

<div class="form-container">
  <label>اسم العميل</label>
  <input type="text" id="clientName" placeholder="اكتب اسم العميل">

  <label>رقم العميل</label>
  <input type="text" id="clientNumber" placeholder="اكتب رقم العميل">

  <label>قيمة الباقة المشترك عليها</label>
  <input type="number" id="packageValue" placeholder="قيمة الباقة">

  <label>عدد أيام الباقة الأساسية</label>
  <input type="number" id="totalDays" placeholder="مثلاً 30">

  <label>عدد الأيام المستفاد بها</label>
  <input type="number" id="daysUsed" placeholder="الأيام المستفاد بها">

  <label>اسم البنك</label>
  <input type="text" id="bankName" placeholder="اسم البنك">

  <label>رقم الحساب البنكي</label>
  <input type="text" id="bankAccount" placeholder="رقم الحساب">

  <label>نوع الاشتراك</label>
  <select id="subscriptionType">
    <option value="">اختر نوع الاشتراك</option>
    <option value="جديد تطبيق">جديد تطبيق</option>
    <option value="تجديد تطبيق">تجديد تطبيق</option>
    <option value="جديد يدوي">جديد يدوي</option>
    <option value="تجديد يدوي">تجديد يدوي</option>
  </select>

  <label>الملاحظات</label>
  <input type="text" id="notes" placeholder="اكتب الملاحظات إن وجدت">

  <div class="button-group">
    <button onclick="addClient()">💾 حفظ</button>
  </div>
</div>

<table id="clientsTable">
  <tr>
    <th>اسم العميل</th>
    <th>رقم العميل</th>
    <th>قيمة الباقة</th>
    <th>الأيام المستفاد بها</th>
    <th>اسم البنك</th>
    <th>رقم الحساب</th>
    <th>نوع الاشتراك</th>
    <th>المبلغ المسترد</th>
    <th>ملاحظات</th>
    <th>❌</th>
  </tr>
</table>

<div class="button-group" style="margin-top:15px; justify-content:center;">
  <button class="calculate" onclick="calculateAllRefunds()">📊 احسب الاسترداد للجميع</button>
  <button class="export" onclick="exportToExcel()">📥 إصدار ملف Excel</button>
</div>

<div class="signature">Accountant Mousa</div>

<script>
let clients = [];

function addClient() {
  const client = {
    name: document.getElementById('clientName').value.trim(),
    number: document.getElementById('clientNumber').value.trim(),
    package: document.getElementById('packageValue').value.trim(),
    total: document.getElementById('totalDays').value.trim(),
    days: document.getElementById('daysUsed').value.trim(),
    bank: document.getElementById('bankName').value.trim(),
    account: document.getElementById('bankAccount').value.trim(),
    type: document.getElementById('subscriptionType').value.trim(),
    refund: '', 
    notes: document.getElementById('notes').value.trim()
  };

  if (!client.name || !client.number) return alert("أدخل بيانات العميل الأساسية.");

  clients.push(client);
  renderTable();
  clearInputs();
}

function calculateAllRefunds() {
  clients.forEach(c => {
    const packageValue = parseFloat(c.package);
    const totalDays = parseFloat(c.total);
    const daysUsed = parseFloat(c.days);
    if (!isNaN(packageValue) && !isNaN(totalDays) && !isNaN(daysUsed) && totalDays > 0) {
      const refund = ((totalDays - daysUsed) / totalDays) * packageValue;
      c.refund = refund.toFixed(2);
      c.package = `${packageValue} (${totalDays})`;
    }
  });
  renderTable();
}

function removeClient(index) {
  clients.splice(index, 1);
  renderTable();
}

function renderTable() {
  const table = document.getElementById("clientsTable");
  table.innerHTML = `
    <tr>
      <th>اسم العميل</th>
      <th>رقم العميل</th>
      <th>قيمة الباقة</th>
      <th>الأيام المستفاد بها</th>
      <th>اسم البنك</th>
      <th>رقم الحساب</th>
      <th>نوع الاشتراك</th>
      <th>المبلغ المسترد</th>
      <th>ملاحظات</th>
      <th>❌</th>
    </tr>
  `;

  clients.forEach((c, i) => {
    const row = `
      <tr>
        <td>${c.name}</td>
        <td>${c.number}</td>
        <td>${c.package}</td>
        <td>${c.days}</td>
        <td>${c.bank}</td>
        <td>${c.account}</td>
        <td>${c.type}</td>
        <td>${c.refund}</td>
        <td>${c.notes}</td>
        <td><button onclick="removeClient(${i})" style="background:red; color:white; border:none; border-radius:5px; padding:3px 8px; cursor:pointer;">X</button></td>
      </tr>`;
    table.innerHTML += row;
  });
}

function clearInputs() {
  document.querySelectorAll('input').forEach(i => i.value = '');
  document.getElementById('subscriptionType').value = '';
}

function exportToExcel() {
  let html = `
    <table border='1' style='border-collapse:collapse; font-family:Tahoma; font-size:14px;'>
      <tr>
        <th style='background-color:#1a73e8; color:white;'>اسم العميل</th>
        <th style='background-color:#1a73e8; color:white;'>رقم العميل</th>
        <th style='background-color:#1a73e8; color:white;'>قيمة الباقة</th>
        <th style='background-color:#1a73e8; color:white;'>الأيام المستفاد بها</th>
        <th style='background-color:#1a73e8; color:white;'>اسم البنك</th>
        <th style='background-color:#1a73e8; color:white;'>رقم الحساب</th>
        <th style='background-color:#1a73e8; color:white;'>نوع الاشتراك</th>
        <th style='background-color:#1a73e8; color:white;'>المبلغ المسترد</th>
        <th style='background-color:#1a73e8; color:white;'>ملاحظات</th>
      </tr>
  `;

  clients.forEach(c => {
    html += `
      <tr>
        <td>${c.name}</td>
        <td>${c.number}</td>
        <td>${c.package}</td>
        <td>${c.days}</td>
        <td>${c.bank}</td>
        <td>${c.account}</td>
        <td>${c.type}</td>
        <td>${c.refund}</td>
        <td>${c.notes}</td>
      </tr>`;
  });

  html += `</table>`; // حذف التوقيع من الملف

  const blob = new Blob([html], { type: "application/vnd.ms-excel" });
  const url = URL.createObjectURL(blob);
  const link = document.createElement("a");
  link.href = url;

  const today = new Date();
  today.setDate(today.getDate() - 1); // اسم الملف بالأمس
  const dateStr = today.toLocaleDateString("en-GB", { day: "2-digit", month: "long", year: "numeric" });

  link.download = `الاسترداد اليومي ${dateStr}.xls`;
  link.click();
}
</script>

</body>
</html>
