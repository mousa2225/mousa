<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ</title>
<style>
body {
  font-family: "Tahoma", Arial, sans-serif;
  background: linear-gradient(180deg, #e0f7fa 0%, #ffffff 100%);
  margin: 0;
  padding: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
  box-sizing: border-box;
}
h1 { 
  color: #0288d1; 
  text-align: center; 
  margin-bottom: 25px; 
  font-size: 24px; 
}
.container {
  width: 100%;
  max-width: 480px;
  background: #fff;
  border-radius: 14px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  padding: 20px;
  box-sizing: border-box;
  margin-bottom: 20px;
}
label { 
  font-weight: bold; 
  color: #00796b; 
  font-size: 14px; 
  margin-top: 10px; 
}
input, select {
  width: 100%; 
  padding: 10px; 
  margin-top: 5px; 
  border: 2px solid #03a9f4;
  border-radius: 6px; 
  font-size: 14px; 
  text-align: center; 
  transition: 0.3s;
  box-sizing: border-box;
}
input:focus, select:focus { 
  border-color: #0288d1; 
  background-color: #e1f5fe; 
  outline: none; 
}
button {
  width: 100%; 
  background-color: #03a9f4; 
  color: white; 
  border: none;
  padding: 10px; 
  border-radius: 6px; 
  cursor: pointer; 
  font-size: 15px; 
  font-weight: bold;
  margin-top: 10px; 
  transition: 0.3s;
}
button:hover { background-color: #0288d1; }
button.delete { background-color: #f44336; font-size: 13px; padding: 6px 8px; }
.success-message { 
  color: green; 
  font-weight: bold; 
  text-align: center; 
  display: none; 
  margin-top: 10px; 
  font-size: 14px; 
}
.success-message::before { content: "âœ” "; }
.table-wrapper { 
  width: 100%; 
  overflow-x: auto; 
  margin-top: 20px; 
}
table { 
  width: 100%; 
  min-width: 400px; 
  border-collapse: collapse; 
  text-align: center; 
  font-size: 13px; 
}
th, td { 
  border: 1px solid #03a9f4; 
  padding: 8px; 
  text-align: center; 
}
th { 
  background-color: #2196f3; 
  color: white; 
}
tr.exceptional td { 
  background-color: #fff3e0; 
}
tr:nth-child(even):not(.exceptional) td { 
  background-color: #e1bee7; 
}
@media (max-width: 600px) { 
  body { padding: 10px; } 
  h1 { font-size: 20px; } 
  .container { padding: 15px; } 
  button { font-size: 14px; } 
  table { font-size: 12px; } 
}
.modal { display: none; position: fixed; z-index: 999; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
.modal-content { background-color: #fff; margin: 5% auto; padding: 20px; border-radius: 14px; max-width: 480px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); position: relative; display: flex; flex-direction: column; }
.close { position: absolute; top: 10px; right: 15px; font-size: 22px; font-weight: bold; cursor: pointer; color:#f44336; }
.signature {
  margin-top: 30px;
  font-family: 'Brush Script MT', cursive, sans-serif; 
  font-size: 26px;
  color: #2c3e50;
  text-align: right; 
  font-style: italic;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
}
</style>
</head>
<body>

<h1>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h1>

<div class="container">
  <div class="success-message" id="successMsg">ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØ­Ø³Ø§Ø¨ Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­</div>

  <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
  <input type="text" id="clientName" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
  <label>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
  <input type="text" id="clientNumber" placeholder="Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
  <label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø§Ù‚Ø©</label>
  <input type="number" id="packageValue" placeholder="Ø§Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø§Ù‚Ø©">
  <label>Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</label>
  <input type="number" id="packageDays" placeholder="Ø§Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…">
  <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³ØªÙØ§Ø¯ Ø¨Ù‡Ø§</label>
  <input type="number" id="daysUsed" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³ØªÙØ§Ø¯ Ø¨Ù‡Ø§">
  <label>Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ</label>
  <input type="text" id="bankName" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ">
  <label>Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</label>
  <input type="text" id="bankAccount" placeholder="Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨">
  <label>Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</label>
  <select id="subscriptionType">
    <option value="" disabled selected hidden>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</option>
    <option value="ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯">ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯</option>
    <option value="ØªØ·Ø¨ÙŠÙ‚ ØªØ¬Ø¯ÙŠØ¯">ØªØ·Ø¨ÙŠÙ‚ ØªØ¬Ø¯ÙŠØ¯</option>
    <option value="Ø¬Ø¯ÙŠØ¯ ÙŠØ¯ÙˆÙŠ">Ø¬Ø¯ÙŠØ¯ ÙŠØ¯ÙˆÙŠ</option>
    <option value="ØªØ¬Ø¯ÙŠØ¯ ÙŠØ¯ÙˆÙŠ">ØªØ¬Ø¯ÙŠØ¯ ÙŠØ¯ÙˆÙŠ</option>
  </select>
  <label>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
  <input type="text" id="notes" placeholder="Ø§Ø¯Ø®Ù„ Ù…Ù„Ø§Ø­Ø¸Ø§Øª">

  <button onclick="addAndCalculate()">ğŸ’¾ Ø­ÙØ¸ ÙˆØ­Ø³Ø§Ø¨ Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯</button>
  <button onclick="openExceptionalModal()">ğŸŒŸ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠ</button>

  <div class="signature">Accountant Mousa Muhammad</div>
</div>

<div id="exceptionalModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeExceptionalModal()">&times;</span>
    <h2>Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠ</h2>

    <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
    <input type="text" id="exceptionalName" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
    <label>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
    <input type="text" id="exceptionalNumber" placeholder="Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
    <label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø§Ù‚Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
    <input type="number" id="exceptionalPackageValue" placeholder="Ø§Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø§Ù‚Ø©">
    <label>Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø¨Ø§Ù‚Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
    <input type="number" id="exceptionalPackageDays" placeholder="Ø§Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…">
    <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³ØªÙØ§Ø¯ Ø¨Ù‡Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
    <input type="number" id="exceptionalDaysUsed" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³ØªÙØ§Ø¯ Ø¨Ù‡Ø§">
    <label>Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ</label>
    <input type="text" id="exceptionalBank" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ">
    <label>Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</label>
    <input type="text" id="exceptionalAccount" placeholder="Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨">
    <label>Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</label>
    <select id="exceptionalType">
      <option value="" disabled selected hidden>Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</option>
      <option value="ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯">ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯</option>
      <option value="ØªØ·Ø¨ÙŠÙ‚ ØªØ¬Ø¯ÙŠØ¯">ØªØ·Ø¨ÙŠÙ‚ ØªØ¬Ø¯ÙŠØ¯</option>
      <option value="Ø¬Ø¯ÙŠØ¯ ÙŠØ¯ÙˆÙŠ">Ø¬Ø¯ÙŠØ¯ ÙŠØ¯ÙˆÙŠ</option>
      <option value="ØªØ¬Ø¯ÙŠØ¯ ÙŠØ¯ÙˆÙŠ">ØªØ¬Ø¯ÙŠØ¯ ÙŠØ¯ÙˆÙŠ</option>
    </select>
    <label>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ±Ø¯ ÙŠØ¯ÙˆÙŠÙ‹Ø§</label>
    <input type="number" id="exceptionalRefund" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ±Ø¯">
    <label>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
    <input type="text" id="exceptionalNotes" placeholder="Ø§Ø¯Ø®Ù„ Ù…Ù„Ø§Ø­Ø¸Ø§Øª">

    <button onclick="saveExceptionalClient()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠ</button>
  </div>
</div>

<div class="table-wrapper">
  <table id="clientsTable">
    <tr>
      <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
      <th>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø§Ù‚Ø© (Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…)</th>
      <th>Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³ØªÙØ§Ø¯ Ø¨Ù‡Ø§</th>
      <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ±Ø¯</th>
      <th>ØªØ¹Ø¯ÙŠÙ„</th>
      <th>Ø­Ø°Ù</th>
    </tr>
  </table>
</div>

<button onclick="exportToExcel()">ğŸ“¥ Ø¥ØµØ¯Ø§Ø± Ù…Ù„Ù Excel</button>

<script>
let clients = [];

function addAndCalculate() {
  const name = document.getElementById('clientName').value.trim();
  const number = document.getElementById('clientNumber').value.trim();
  const packageValue = parseFloat(document.getElementById('packageValue').value);
  const packageDays = parseFloat(document.getElementById('packageDays').value);
  const daysUsed = parseFloat(document.getElementById('daysUsed').value);
  const bank = document.getElementById('bankName').value.trim();
  const account = document.getElementById('bankAccount').value.trim();
  const type = document.getElementById('subscriptionType').value;
  const notes = document.getElementById('notes').value.trim();

  if (!name || !number) { alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„"); return; }
  if (daysUsed > packageDays) { alert("Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³ØªÙØ§Ø¯ Ø¨Ù‡Ø§ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠØªØ¬Ø§ÙˆØ² Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„ÙƒÙ„ÙŠ Ù„Ù„Ø¨Ø§Ù‚Ø©"); return; }

  const refund = ((packageValue / packageDays) * (packageDays - daysUsed)).toFixed(2);

  clients.push({ name, number, packageValue, packageDays, daysUsed, bank, account, type, notes, refund, exceptional: false });
  
  document.getElementById('successMsg').style.display = 'block';
  setTimeout(()=>document.getElementById('successMsg').style.display='none', 2000);

  renderTable();
  clearInputs();
}

function clearInputs() { document.querySelectorAll('.container input').forEach(i=>i.value=''); }

function openExceptionalModal() { document.getElementById('exceptionalModal').style.display='block'; }
function closeExceptionalModal() { document.getElementById('exceptionalModal').style.display='none'; }

function saveExceptionalClient() {
  const name = document.getElementById('exceptionalName').value.trim();
  const number = document.getElementById('exceptionalNumber').value.trim();
  const packageValue = parseFloat(document.getElementById('exceptionalPackageValue').value) || 0;
  const packageDays = parseFloat(document.getElementById('exceptionalPackageDays').value) || 0;
  const daysUsed = parseFloat(document.getElementById('exceptionalDaysUsed').value) || 0;
  const bank = document.getElementById('exceptionalBank').value.trim();
  const account = document.getElementById('exceptionalAccount').value.trim();
  const type = document.getElementById('exceptionalType').value;
  const refund = parseFloat(document.getElementById('exceptionalRefund').value);
  const notes = document.getElementById('exceptionalNotes').value.trim();

  if (!name || !number || isNaN(refund)) { alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø±Ù‚Ù… ÙˆØ§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ±Ø¯"); return; }

  clients.push({ name, number, packageValue, packageDays, daysUsed, bank, account, type, notes, refund: refund.toFixed(2), exceptional:true });
  renderTable();
  closeExceptionalModal();
  document.querySelectorAll('#exceptionalModal input').forEach(i=>i.value='');
}

function renderTable() {
  const table = document.getElementById('clientsTable');
  table.innerHTML = `<tr>
    <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
    <th>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø§Ù‚Ø© (Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…)</th>
    <th>Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³ØªÙØ§Ø¯ Ø¨Ù‡Ø§</th>
    <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ±Ø¯</th>
    <th>ØªØ¹Ø¯ÙŠÙ„</th>
    <th>Ø­Ø°Ù</th>
  </tr>`;

  clients.forEach((c,index)=>{
    table.innerHTML += `<tr class="${c.exceptional?'exceptional':''}">
      <td>${c.name}</td>
      <td>${c.packageValue} (${c.packageDays})</td>
      <td>${c.daysUsed}</td>
      <td>${c.refund}</td>
      <td><button onclick="editClient(${index})">âœï¸</button></td>
      <td><button class="delete" onclick="deleteClient(${index})">ğŸ—‘ï¸</button></td>
    </tr>`;
  });
}

function deleteClient(index) {
  if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŸ")){
    clients.splice(index,1);
    renderTable();
  }
}

function editClient(index){
  const c = clients[index];
  const modalHTML = `
  <div class="modal-content">
    <span class="close" onclick="document.getElementById('editModal').remove()">&times;</span>
    <h2>ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„${c.exceptional ? ' Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠ' : ''}</h2>
    <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label><input id="editName" value="${c.name}">
    <label>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label><input id="editNumber" value="${c.number}">
    <label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø§Ù‚Ø©</label><input type="number" id="editPackageValue" value="${c.packageValue}">
    <label>Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</label><input type="number" id="editPackageDays" value="${c.packageDays}">
    <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³ØªÙØ§Ø¯ Ø¨Ù‡Ø§</label><input type="number" id="editDaysUsed" value="${c.daysUsed}">
    <label>Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ</label><input id="editBank" value="${c.bank}">
    <label>Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</label><input id="editAccount" value="${c.account}">
    <label>Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</label>
    <select id="editType">
      <option value="ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯" ${c.type=="ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯"?'selected':''}>ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯</option>
      <option value="ØªØ·Ø¨ÙŠÙ‚ ØªØ¬Ø¯ÙŠØ¯" ${c.type=="ØªØ·Ø¨ÙŠÙ‚ ØªØ¬Ø¯ÙŠØ¯"?'selected':''}>ØªØ·Ø¨ÙŠÙ‚ ØªØ¬Ø¯ÙŠØ¯</option>
      <option value="Ø¬Ø¯ÙŠØ¯ ÙŠØ¯ÙˆÙŠ" ${c.type=="Ø¬Ø¯ÙŠØ¯ ÙŠØ¯ÙˆÙŠ"?'selected':''}>Ø¬Ø¯ÙŠØ¯ ÙŠØ¯ÙˆÙŠ</option>
      <option value="ØªØ¬Ø¯ÙŠØ¯ ÙŠØ¯ÙˆÙŠ" ${c.type=="ØªØ¬Ø¯ÙŠØ¯ ÙŠØ¯ÙˆÙŠ"?'selected':''}>ØªØ¬Ø¯ÙŠØ¯ ÙŠØ¯ÙˆÙŠ</option>
    </select>
    <label>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ±Ø¯${c.exceptional ? ' ÙŠØ¯ÙˆÙŠÙ‹Ø§' : ''}</label><input type="number" id="editRefund" value="${c.refund}">
    <label>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label><input id="editNotes" value="${c.notes}">
    <button onclick="saveEdit(${index})">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
  </div>`;
  
  let modalDiv = document.createElement('div');
  modalDiv.className = 'modal';
  modalDiv.id = 'editModal';
  modalDiv.innerHTML = modalHTML;
  document.body.appendChild(modalDiv);
  modalDiv.style.display = 'block';
}

function saveEdit(index){
  const c = clients[index];
  c.name = document.getElementById('editName').value.trim();
  c.number = document.getElementById('editNumber').value.trim();
  c.packageValue = parseFloat(document.getElementById('editPackageValue').value);
  c.packageDays = parseFloat(document.getElementById('editPackageDays').value);
  c.daysUsed = parseFloat(document.getElementById('editDaysUsed').value);
  c.bank = document.getElementById('editBank').value.trim();
  c.account = document.getElementById('editAccount').value.trim();
  c.type = document.getElementById('editType').value;
  c.notes = document.getElementById('editNotes').value.trim();
  c.refund = parseFloat(document.getElementById('editRefund').value).toFixed(2);

  renderTable();
  document.getElementById('editModal').remove();
}

function exportToExcel() {
  let html = `<table border='1' style='border-collapse:collapse; font-family:Tahoma; direction:rtl; text-align:center;'>`;
  html += `<tr>
    <th style="background-color:#2196f3; color:white;">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
    <th style="background-color:#2196f3; color:white;">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
    <th style="background-color:#2196f3; color:white;">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø§Ù‚Ø© (Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…)</th>
    <th style="background-color:#2196f3; color:white;">Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³ØªÙØ§Ø¯ Ø¨Ù‡Ø§</th>
    <th style="background-color:#2196f3; color:white;">Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ</th>
    <th style="background-color:#2196f3; color:white;">Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</th>
    <th style="background-color:#2196f3; color:white;">Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th>
    <th style="background-color:#2196f3; color:white;">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ±Ø¯</th>
    <th style="background-color:#2196f3; color:white;">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
  </tr>`;

  let normalRowCount = 0;
  clients.forEach(c => {
    let bg = c.exceptional ? "#fff3e0" : (normalRowCount % 2 === 0 ? "#ffffff" : "#e1bee7");
    if(!c.exceptional) normalRowCount++;

    html += `<tr style="background-color:${bg}; text-align:center;">
      <td>${c.name}</td>
      <td>${c.number}</td>
      <td>${c.packageValue} (${c.packageDays})</td>
      <td>${c.daysUsed}</td>
      <td>${c.bank}</td>
      <td>${c.account}</td>
      <td>${c.type}</td>
      <td>${c.refund}</td>
      <td>${c.notes}</td>
    </tr>`;
  });

  html += "</table>";

  const blob = new Blob([html], {type:"application/vnd.ms-excel"});
  const url = URL.createObjectURL(blob);
  const link = document.createElement("a");

  const today = new Date();
  today.setDate(today.getDate()-1);
  const options = { day:'numeric', month:'long', year:'numeric'};
  const arabicDate = today.toLocaleDateString('ar-EG', options);
  const gregDate = today.toISOString().split('T')[0];

  link.href = url;
  link.download = `Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ ${arabicDate} (${gregDate}).xls`;
  link.click();
}
</script>

</body>
</html>
