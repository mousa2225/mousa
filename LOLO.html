<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8"> <!-- ØªØ±Ù…ÙŠØ² Ø§Ù„Ø­Ø±ÙˆÙ UTF-8 Ù„Ø¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© -->
<meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Ù„Ø¬Ø¹Ù„ Ø§Ù„ØµÙØ­Ø© Ù…ØªØ¬Ø§ÙˆØ¨Ø© Ù…Ø¹ Ø§Ù„Ù‡ÙˆØ§ØªÙ -->
<title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ</title> <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø© ÙÙŠ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ -->

<style>
/* ======================== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ø© ======================== */
body {
  font-family: "Tahoma", Arial, sans-serif;
  background: linear-gradient(180deg, #e0f7fa 0%, #ffffff 100%);
  margin: 0;
  padding: 20px;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
  box-sizing: border-box;
}

/* ======================== Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ======================== */
h1 {
  color: #0288d1;
  text-align: center;
  margin-bottom: 25px;
  font-size: 24px;
}

/* ======================== Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ======================== */
.container {
  width: 100%;
  max-width: 480px;
  background: #fff;
  border-radius: 14px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  padding: 20px;
  box-sizing: border-box;
  margin-bottom: 20px;
}

/* ======================== Ø§Ù„Ø­Ù‚ÙˆÙ„ ======================== */
label {
  font-weight: bold;
  color: #00796b;
  font-size: 14px;
  margin-top: 10px;
}

input, select {
  width: 100%;
  padding: 10px;
  margin-top: 5px;
  border: 2px solid #03a9f4;
  border-radius: 6px;
  font-size: 14px;
  text-align: center;
  transition: 0.3s;
  box-sizing: border-box;
}

input:focus, select:focus {
  border-color: #0288d1;
  background-color: #e1f5fe;
  outline: none;
}

/* ======================== Ø§Ù„Ø£Ø²Ø±Ø§Ø± ======================== */
button {
  width: 100%;
  background-color: #03a9f4;
  color: white;
  border: none;
  padding: 10px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 15px;
  font-weight: bold;
  margin-top: 10px;
  transition: 0.3s;
}

button:hover { background-color: #0288d1; }
button.calculate { background-color: #00bcd4; }
button.delete { background-color: #f44336; font-size: 13px; padding: 6px 8px; }

/* ======================== Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ ======================== */
.success-message {
  color: green;
  font-weight: bold;
  text-align: center;
  display: none;
  margin-top: 10px;
  font-size: 14px;
}
.success-message::before { content: "âœ” "; }

/* ======================== Ø§Ù„Ø¬Ø¯ÙˆÙ„ ======================== */
.table-wrapper {
  width: 100%;
  overflow-x: auto;
  margin-top: 20px;
}

table {
  width: 100%;
  min-width: 400px;
  border-collapse: collapse;
  text-align: center;
  font-size: 13px;
}

th, td {
  border: 1px solid #03a9f4;
  padding: 8px;
}

th { background-color: #03a9f4; color: white; }
tr:nth-child(even) td { background-color: #e1f5fe; }

/* ======================== Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© ======================== */
@media (max-width: 600px) {
  body { padding: 10px; }
  h1 { font-size: 20px; }
  .container { padding: 15px; }
  button { font-size: 14px; }
  table { font-size: 12px; }
}

/* ======================== Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠ ======================== */
.exceptional-container {
  width: 100%;
  max-width: 480px;
  background: #fff3e0; /* Ø®Ù„ÙÙŠØ© Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠØ© ÙØ§ØªØ­Ø© */
  border-radius: 14px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  padding: 20px;
  box-sizing: border-box;
  margin-bottom: 20px;
}
h2 {
  color: #ff9800;
  text-align: center;
  margin-bottom: 15px;
}
</style>
</head>

<body>

<h1>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h1>

<!-- ======================== Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø¹Ø§Ø¯ÙŠÙŠÙ† ======================== -->
<div class="container">
  <div class="success-message" id="successMsg">ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­</div>

  <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
  <input type="text" id="clientName" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">

  <label>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
  <input type="text" id="clientNumber" placeholder="Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">

  <label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø§Ù‚Ø©</label>
  <input type="number" id="packageValue" placeholder="Ø§Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø§Ù‚Ø©">

  <label>Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</label>
  <input type="number" id="packageDays" placeholder="Ø§Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…">

  <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³ØªÙØ§Ø¯ Ø¨Ù‡Ø§</label>
  <input type="number" id="daysUsed" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³ØªÙØ§Ø¯ Ø¨Ù‡Ø§">

  <label>Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ</label>
  <input type="text" id="bankName" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ">

  <label>Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</label>
  <input type="text" id="bankAccount" placeholder="Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨">

  <label>Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</label>
  <select id="subscriptionType">
    <option value="Ø¬Ø¯ÙŠØ¯ ØªØ·Ø¨ÙŠÙ‚">Ø¬Ø¯ÙŠØ¯ ØªØ·Ø¨ÙŠÙ‚</option>
    <option value="ØªØ¬Ø¯ÙŠØ¯ ØªØ·Ø¨ÙŠÙ‚">ØªØ¬Ø¯ÙŠØ¯ ØªØ·Ø¨ÙŠÙ‚</option>
    <option value="Ø¬Ø¯ÙŠØ¯ ÙŠØ¯ÙˆÙŠ">Ø¬Ø¯ÙŠØ¯ ÙŠØ¯ÙˆÙŠ</option>
    <option value="ØªØ¬Ø¯ÙŠØ¯ ÙŠØ¯ÙˆÙŠ">ØªØ¬Ø¯ÙŠØ¯ ÙŠØ¯ÙˆÙŠ</option>
  </select>

  <label>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
  <input type="text" id="notes" placeholder="Ø§Ø¯Ø®Ù„ Ù…Ù„Ø§Ø­Ø¸Ø§Øª">

  <button onclick="addClient()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
  <button class="calculate" onclick="calculateRefund()">ğŸ’° Ø§Ø­Ø³Ø¨ Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯</button>
</div>

<!-- ======================== Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠÙŠÙ† ======================== -->
<div class="exceptional-container">
  <h2>ğŸŒŸ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ù…Ù…ÙŠØ²</h2>

  <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ù…Ù…ÙŠØ²</label>
  <input type="text" id="exceptionalName" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">

  <label>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
  <input type="text" id="exceptionalNumber" placeholder="Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">

  <label>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ±Ø¯ ÙŠØ¯ÙˆÙŠÙ‹Ø§</label>
  <input type="number" id="exceptionalRefund" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ±Ø¯">

  <button onclick="saveExceptionalClient()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ù…Ù…ÙŠØ²</button>
</div>

<!-- ======================== Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ======================== -->
<div class="table-wrapper">
  <table id="clientsTable">
    <tr>
      <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
      <th>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø§Ù‚Ø© (Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…)</th>
      <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ±Ø¯</th>
      <th>Ø­Ø°Ù</th>
    </tr>
  </table>
</div>

<!-- Ø²Ø± ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel -->
<button onclick="exportToExcel()">ğŸ“¥ Ø¥ØµØ¯Ø§Ø± Ù…Ù„Ù Excel</button>

<script>
// ======================= Ù…ØµÙÙˆÙØ© Ù„ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ =======================
let clients = [];

// ======================= Ø¯Ø§Ù„Ø© Ø­ÙØ¸ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø§Ø¯ÙŠ =======================
function addClient() {
  const name = document.getElementById('clientName').value.trim();
  const number = document.getElementById('clientNumber').value.trim();
  const packageValue = parseFloat(document.getElementById('packageValue').value);
  const packageDays = parseFloat(document.getElementById('packageDays').value);
  const daysUsed = parseFloat(document.getElementById('daysUsed').value);
  const bank = document.getElementById('bankName').value.trim();
  const account = document.getElementById('bankAccount').value.trim();
  const type = document.getElementById('subscriptionType').value;
  const notes = document.getElementById('notes').value.trim();

  if (!name || !number) { alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„"); return; }
  if (daysUsed > packageDays) { alert("Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³ØªÙØ§Ø¯ Ø¨Ù‡Ø§ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠØªØ¬Ø§ÙˆØ² Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„ÙƒÙ„ÙŠ Ù„Ù„Ø¨Ø§Ù‚Ø©"); return; }

  clients.push({ 
    name, number, packageValue, packageDays, daysUsed, bank, account, type, notes, refund: '', exceptional: false 
  });

  document.getElementById('successMsg').style.display = 'block';
  setTimeout(() => document.getElementById('successMsg').style.display = 'none', 2000);

  renderTable();
  clearInputs();
}

function clearInputs() {
  document.querySelectorAll('input').forEach(i => i.value = '');
}

// ======================= Ø¯Ø§Ù„Ø© Ø­ÙØ¸ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠ =======================
function saveExceptionalClient() {
  const name = document.getElementById('exceptionalName').value.trim();
  const number = document.getElementById('exceptionalNumber').value.trim();
  const refund = parseFloat(document.getElementById('exceptionalRefund').value);

  if (!name || !number || isNaN(refund)) { alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­"); return; }

  clients.push({
    name,
    number,
    packageValue: 0,
    packageDays: 0,
    daysUsed: 0,
    bank: '',
    account: '',
    type: 'Ø¹Ù…ÙŠÙ„ Ù…Ù…ÙŠØ²',
    notes: '',
    refund: refund.toFixed(2),
    exceptional: true
  });

  renderTable();
  document.getElementById('exceptionalName').value = '';
  document.getElementById('exceptionalNumber').value = '';
  document.getElementById('exceptionalRefund').value = '';
}

// ======================= Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ±Ø¯ =======================
function calculateRefund() {
  clients.forEach(c => {
    if (!c.exceptional) {
      c.refund = ((c.packageValue / c.packageDays) * (c.packageDays - c.daysUsed)).toFixed(2);
    }
  });
  renderTable();
}

// ======================= Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„ =======================
function renderTable() {
  const table = document.getElementById("clientsTable");
  table.innerHTML = `
    <tr>
      <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
      <th>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø§Ù‚Ø© (Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…)</th>
      <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ±Ø¯</th>
      <th>Ø­Ø°Ù</th>
    </tr>
  `;
  clients.forEach((c, index) => {
    table.innerHTML += `
      <tr>
        <td>${c.name}</td>
        <td>${c.packageValue} (${c.packageDays})</td>
        <td>${c.refund || "-"}</td>
        <td><button class="delete" onclick="deleteClient(${index})">ğŸ—‘ï¸</button></td>
      </tr>
    `;
  });
}

// ======================= Ø­Ø°Ù Ø¹Ù…ÙŠÙ„ =======================
function deleteClient(index) {
  if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŸ")) {
    clients.splice(index, 1);
    renderTable();
  }
}

// ======================= ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel =======================
function exportToExcel() {
  let html = `<table border='1' style='border-collapse:collapse; font-family:Tahoma; font-size:14px;'>`;
  html += `<tr>
    <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
    <th>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
    <th>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¨Ø§Ù‚Ø© (Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…)</th>
    <th>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø³ØªÙØ§Ø¯ Ø¨Ù‡Ø§</th>
    <th>Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ</th>
    <th>Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ</th>
    <th>Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</th>
    <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ±Ø¯</th>
    <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
  </tr>`;
  clients.forEach(c => {
    html += `<tr>
      <td>${c.name}</td>
      <td>${c.number}</td>
      <td>${c.packageValue} (${c.packageDays})</td>
      <td>${c.daysUsed}</td>
      <td>${c.bank}</td>
      <td>${c.account}</td>
      <td>${c.type}</td>
      <td>${c.refund}</td>
      <td>${c.notes}</td>
    </tr>`;
  });
  html += "</table>";

  const blob = new Blob([html], { type: "application/vnd.ms-excel" });
  const url = URL.createObjectURL(blob);
  const link = document.createElement("a");
  const today = new Date();
  const dateStr = today.toLocaleDateString('ar-EG', { day: '2-digit', month: 'long', year:'numeric' });

  link.href = url;
  link.download = `Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ ${dateStr}.xls`;
  link.click();
}
</script>

</body>
</html>
